
<!DOCTYPE HTML>
<!--
	Dopetrope 2.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html data-theme="dark">
	<head>
			<title>书言</title>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<meta charset="utf-8" />

			<!-- <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,300italic" rel="stylesheet" /> -->
			<link rel="stylesheet" href="/theme/css/custom-pygment.css" />
			<noscript>
				<link rel="stylesheet" href="/theme/css/skel-noscript.css" />
				<link rel="stylesheet" href="/theme/css/style.css" />
				<link rel="stylesheet" href="/theme/css/style-desktop.css" />
			</noscript>

		<!-- tipuesearch 放在这, 因为搜索框是全局定义的 -->
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/tipuesearch.css" />
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/custom/tipuesearch-custom.css" />
		<link rel="stylesheet" href="/theme/css/alabaster.css" />
		<link rel="stylesheet" href="/theme/css/custom-alabaster.css" />
		<!-- <link rel="stylesheet" href="/theme/fontawesome-free-6.5.1-web/css/all.min.css" /> -->
		<!--  <link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-brands-400.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-regular-400.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-solid-900.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-v4compatibility.woff2" /> -->


	</head>
	<body class="no-sidebar">

		<!-- 内容 -->
		<div>

			<!-- Header Wrapper -->
			<div id="header-wrapper">
				<div class="container">
					<div class="row">
						<div class="12u">

							<!-- Header -->
								<section id="header">

									<!-- Logo -->
									<div class="page-home">
										<h1><a href="/">HOME</a></h1>
									</div>

									<!-- Nav -->
									<div class="page-menu">
										<nav id="nav">
											<ul>

												<!-- categories -->
														<li ><a href="/category/ai.html">AI</a></li>
														<li ><a href="/category/an-quan.html">安全</a></li>
														<li ><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
														<li ><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
														<li ><a href="/category/chang-yong-gong-ju-shi-yong.html">常用工具使用</a></li>
														<li ><a href="/category/da-shu-ju.html">大数据</a></li>
														<li><a href="/categories.html">More...</a></li>
											</ul>
										</nav>
									</div>
								</section>

						</div>
					</div>
					<div class="row page-head-search">
						<form class="navbar-search" action="/search.html" role="search">
							<!-- <button class="fa-solid fa-magnifying-glass" type="submit"></button> -->
							<button type="submit"></button>
							<input type="text" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
							<!-- <i class="fa-solid fa-magnifying-glass"></i> -->
						</form>
					</div>
  <div class="row page-head page-article persistent">
    <div class="page-head-title">
      <h2>nginx概念详解</h2>
    </div>
    <div class="page-head-content">
      By
	  <a href="author/yanque.html">YanQue</a>
      , 20 February 2023
      , Category:
	  <a href="category/rong-qi-yu-ji-qun.html">容器与集群</a>
    </div>
	<div class="red-line">
    </div>
  </div>
				</div>

				<!-- 头部下方动效 -->
				<div class="waves-area">
					<section class="main-hero-waves-area waves-area">
						<svg class="waves-svg" preserveAspectRatio="none" shape-rendering="auto" viewBox="0 24 150 28"
							 xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
							<defs>
								<path
										d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"
										id="gentle-wave"></path>
							</defs>
							<g class="parallax">
								<use href="#gentle-wave" x="48" y="0"></use>
								<use href="#gentle-wave" x="48" y="3"></use>
								<use href="#gentle-wave" x="48" y="5"></use>
								<use href="#gentle-wave" x="48" y="7"></use>
							</g>
						</svg>
					</section>
				</div>

			</div>

		<!-- Main Wrapper -->
			<div id="main-wrapper">
				<div class="container">
<div class="row">
	<div class="12u">
			<section>
				<div>
					<div class="row">
						<div class="12u skel-cell-mainContent">
							<!-- Content -->
								<article class="box is-post">
									<div class="box-head">
										<div class="post-infos">
											<ul class="tags">
												<li><a class="button" href="category/rong-qi-yu-ji-qun.html">容器与集群</a></li>
													<li><a class="button button-alt" href="tag/nginx.html">Nginx</a></li>

											</ul>
										</div>

										<div class="pennant pennant-alt date">2023-02-20</div>
										<h2>nginx概念详解</h2>

										<span class="head-modify-time">修改于: 2023-02-20</span>

									</div>
									<p>Nginx联合创始人安德鲁·阿列克谢夫（Andrew Alexeev）曾说：
Nginx是为对Apache性能不满意的人而构建的。随着Internet需求的变化，Web服务器的工作也在变化。
Nginx的构建比以往任何时候都更有效率，更可扩展，更安全，更强大。</p>
<p>本文提供了Nginx的基本概念及知识。以开发者必备的Nginx基础知识为主，罗列了一些Nginx教程，希望对大家有所帮助。</p>
<div class="section" id="nginx-1">
<h2>Nginx的产生</h2>
<p>Nginx 同 Apache 一样都是一种 Web 服务器。
基于 REST 架构风格，以统一资源描述符（Uniform Resources Identifier）URI
或者统一资源定位符（Uniform Resources Locator）URL 作为沟通依据，通过 HTTP 协议提供各种网络服务。</p>
<p>然而，这些服务器在设计之初受到当时环境的局限，
例如当时的用户规模，网络带宽，产品特点等局限并且各自的定位和发展都不尽相同。
这也使得各个 Web 服务器有着各自鲜明的特点。</p>
<p>Apache 的发展时期很长，而且是毫无争议的世界第一大服务器。它有着很多优点：稳定、开源、跨平台等等。</p>
<p>它出现的时间太长了，它兴起的年代，互联网产业远远比不上现在。所以它被设计为一个重量级的。</p>
<p>它不支持高并发的服务器。在 Apache 上运行数以万计的并发访问，会导致服务器消耗大量内存。</p>
<p>操作系统对其进行进程或线程间的切换也消耗了大量的 CPU 资源，导致 HTTP 请求的平均响应速度降低。</p>
<p>这些都决定了 Apache 不可能成为高性能 Web 服务器，轻量级高并发服务器 Nginx 就应运而生了。</p>
<p>俄罗斯的工程师 Igor Sysoev，他在为 Rambler Media 工作期间，使用 C 语言开发了 Nginx。</p>
<p>Nginx 作为 Web 服务器一直为 Rambler Media 提供出色而又稳定的服务。然后呢，Igor Sysoev 将 Nginx 代码开源，并且赋予自由软件许可证。</p>
<dl class="docutils">
<dt>由于以下这几点，所以，Nginx 火了</dt>
<dd><ul class="first last simple">
<li>Nginx 使用基于事件驱动架构，使得其可以支持数以百万级别的 TCP 连接。</li>
<li>高度的模块化和自由软件许可证使得第三方模块层出不穷（这是个开源的时代啊）。</li>
<li>Nginx 是一个跨平台服务器，可以运行在 Linux、Windows、FreeBSD、Solaris、AIX、Mac OS 等操作系统上。</li>
<li>这些优秀的设计带来的极大的稳定性。</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="nginx-2">
<h2>Nginx 基本概念</h2>
<div class="section" id="section-1">
<h3>正向代理与反向代理</h3>
<p>为了便于理解，首先先来了解一下一些基础知识，nginx是一个高性能的反向代理服务器那么什么是反向代理呢？</p>
<p>代理是在服务器和客户端之间假设的一层服务器，代理将接收客户端的请求并将它转发给服务器，然后将服务端的响应转发给客户端。</p>
<p>不管是正向代理还是反向代理，实现的都是上面的功能。</p>
<p>如果对OSI 七层模型与 TCP/IP 四层模型不是很熟悉可以再回顾下</p>
<dl class="docutils">
<dt>正向代理</dt>
<dd><p class="first">正向代理（forward）意思是一个位于客户端和原始服务器 (origin server) 之间的服务器，
为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标 (原始服务器)，
然后代理向原始服务器转交请求并将获得的内容返回给客户端。</p>
<p>正向代理是为我们服务的，即为客户端服务的，客户端可以根据正向代理访问到它本身无法访问到的服务器资源。</p>
<p class="last">正向代理对我们是透明的，对服务端是非透明的，即服务端并不知道自己收到的是来自代理的访问还是来自真实客户端的访问。</p>
</dd>
<dt>反向代理</dt>
<dd><p class="first">反向代理（Reverse Proxy）方式是指以代理服务器来接受 internet 上的连接请求，
然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，
此时代理服务器对外就表现为一个反向代理服务器。</p>
<p>反向代理是为服务端服务的，反向代理可以帮助服务器接收来自客户端的请求，帮助服务器做请求转发，负载均衡等。</p>
<p class="last">反向代理对服务端是透明的，对我们是非透明的，即我们并不知道自己访问的是代理服务器，而服务器知道反向代理在为他服务。</p>
</dd>
</dl>
</div>
<div class="section" id="section-2">
<h3>负载均衡</h3>
<p>如果请求数过大，单个服务器解决不了，我们增加服务器的数量，然后将请求分发到各个服务器上，
将原先请求集中到单个服务器的情况改为请求分发到多个服务器上，就是负载均衡。</p>
<p>Upstream 指定后端服务器地址列表，在 server 中拦截响应请求，并将请求转发到 Upstream 中配置的服务器列表:</p>
<pre class="literal-block">
upstream balanceServer {
    server 10.1.22.33:12345;
    server 10.1.22.34:12345;

    server 10.1.22.35:12345;
    }

server {
    server_name  fe.server.com;
    listen 80;
    location /api {
        proxy_pass http://balanceServer;
        }
    }
</pre>
<p>上面的配置只是指定了 nginx 需要转发的服务端列表，并没有指定分配策略。</p>
<p>默认情况下采用的是轮询策略，将所有客户端请求轮询分配给服务端。
这种策略是可以正常工作的，但是如果其中某一台服务器压力太大，出现延迟，会影响所有分配在这台服务器下的用户。</p>
</div>
<div class="section" id="nginx-3">
<h3>Nginx支持的负载均衡调度算法</h3>
<dl class="docutils">
<dt>weight轮询(默认，常用)</dt>
<dd>接收到的请求按照权重分配到不同的后端服务器，
即使在使用过程中，某一台后端服务器宕机，Nginx会自动将该服务器剔除出队列，
请求受理情况不会受到任何影响。这种方式下，
可以给不同的后端服务器设置一个权重值(weight)，用于调整不同的服务器上请求的分配率；
权重数据越大，被分配到请求的几率越大；
该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。</dd>
<dt>ip_hash（常用）</dt>
<dd>每个请求按照发起客户端的ip的hash结果进行匹配，
这样的算法下一个固定ip地址的客户端总会访问到同一个后端服务器，
这也在一定程度上解决了集群部署环境下session共享的问题。</dd>
<dt>fair</dt>
<dd>智能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配，
响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少；
结合了前两者的优点的一种调度算法。
但是需要注意的是Nginx默认不支持fair算法，如果要使用这种调度算法，
请安装upstream_fair模块。</dd>
<dt>url_hash</dt>
<dd>按照访问的url的hash结果分配请求，每个请求的url会指向后端固定的某个服务器，
可以在Nginx作为静态服务器的情况下提高缓存效率。
同样要注意Nginx默认不支持这种调度算法，要使用的话需要安装Nginx的hash软件包。</dd>
</dl>
</div>
<div class="section" id="section-3">
<h3>动静分离</h3>
<p>为了加快服务器的解析速度，可以把动态页面和静态页面交给不同的服务器来解析，加快解析速度，降低原来单个服务器的压力。</p>
</div>
</div>
<div class="section" id="master-worker">
<span id="nginxmasterandworker"></span><h2>Master 和 Worker 进程</h2>
<p>Nginx包含一个`master`进程和一到多个`worker`进程。如果配置了`缓存`的话，还将包含`缓存加载进程`和`缓存管理进程`。</p>
<p><cite>master</cite> 进程主要负责读取配置文件，并控制管理`workder`进程。</p>
<p><cite>worker</cite> 进程负责处理请求。Nginx基于操作系统的调度机制高效地在`worker`进程间分配请求。可以在`nginx.conf`配置文件中设置`worker`进程的数量，一般设置为服务器的CPU内核数。</p>
</div>
<div class="section" id="nginx-4">
<h2>为什么选择Nginx</h2>
<p>Nginx是一款自由的、开源的、高性能的HTTP服务器和反向代理服务器；
同时也是一个IMAP、POP3、SMTP代理服务器；
Nginx可以作为一个HTTP服务器进行网站的发布处理，
另外Nginx可以作为反向代理进行负载均衡的实现。在Nginx网站上，其功能包括：</p>
<ul class="simple">
<li>HTTP和HTTPS（TLS / SSL / SNI）</li>
<li>超快速的Web服务器用于静态内容</li>
<li>FastCGI，WSGI，SCGI用于动态内容</li>
<li>具有负载平衡和缓存功能的加速Web代理</li>
<li>不间断实时二进制升级和配置</li>
<li>压缩和内容过滤器</li>
<li>虚拟主机</li>
<li>FLV和MP4的媒体流</li>
<li>带宽和连接策略</li>
<li>全面的访问控制</li>
<li>自定义日志</li>
<li>嵌入式脚本</li>
<li>带有TLS的SMTP / IMAP / POP3的邮件代理</li>
<li>逻辑，灵活，可扩展的配置</li>
<li>在Linux，FreeBSD，Mac OS X，Solaris和Windows上运行</li>
</ul>
</div>
<div class="section" id="nginx-5">
<h2>Nginx有如下优势</h2>
<div class="section" id="ioepoll-io">
<h3>IO多路复用epoll（IO复用）</h3>
<p>如何理解呢？举个例子吧！</p>
<p>有A、B、C三个老师，他们都遇到一个难题，要帮助一个班级的学生解决课堂作业。</p>
<ul class="simple">
<li>老师A采用从第一排开始一个学生一个学生轮流解答的方式去回答问题，
老师A浪费了很多时间，并且有的学生作业还没有完成呢，老师就来了，反反复复效率极慢。</li>
<li>老师B是一个忍者，他发现老师A的方法行不通，于是他使用了影分身术，分身出好几个自己同一时间去帮好几个
同学回答问题，最后还没回答完，老师B消耗光了能量累倒了。</li>
<li>老师C比较精明，他告诉学生，谁完成了作业举手，有举手的同学他才去指导问题，
他让学生主动发声，分开了“并发”。这个老师C就是Nginx。</li>
</ul>
</div>
<div class="section" id="section-4">
<h3>轻量级</h3>
<ul class="simple">
<li>功能模块少 - Nginx仅保留了HTTP需要的模块，其他都用插件的方式，后天添加</li>
<li>代码模块化 - 更适合二次开发，如阿里巴巴Tengine</li>
</ul>
</div>
<div class="section" id="cpu">
<h3>CPU亲和</h3>
<p>把CPU核心和Nginx工作进程绑定，把每个worker进程固定在一个CPU上执行，减少切换CPU的cache miss，从而提高性能。</p>
</div>
</div>

								</article>
						</div>
					</div>
				</div>
			</section>
	</div>
</div>

				</div>
			</div>



		<!-- Sider Bar -->
		<div id="right-side-bar">
	<nav>
		<div id="top-toc-tree-container" class="fixed-container">
			<div class="toc-contents-title">
				<h4 id="toc-contents-title-text">Contents</h4>
				<!-- <span class="tool-tip-text">点击隐藏</span> -->
			</div>
			<div id="toc-tree-container">
 <ul class="toc-tree visible">
  <li class="toc-h0">
   <a class="" href="#nginx-1">
    Nginx的产生
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#nginx-2">
    Nginx 基本概念
   </a>
   <ul class="toc-tree visible">
    <li class="toc-h1">
     <a class="" href="#section-1">
      正向代理与反向代理
     </a>
    </li>
    <li class="toc-h1">
     <a class="" href="#section-2">
      负载均衡
     </a>
    </li>
    <li class="toc-h1">
     <a class="" href="#nginx-3">
      Nginx支持的负载均衡调度算法
     </a>
    </li>
    <li class="toc-h1">
     <a class="" href="#section-3">
      动静分离
     </a>
    </li>
   </ul>
  </li>
  <li class="toc-h0">
   <a class="" href="#master-worker">
    Master 和 Worker 进程
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#nginx-4">
    为什么选择Nginx
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#nginx-5">
    Nginx有如下优势
   </a>
   <ul class="toc-tree visible">
    <li class="toc-h1">
     <a class="" href="#ioepoll-io">
      IO多路复用epoll（IO复用）
     </a>
    </li>
    <li class="toc-h1">
     <a class="" href="#section-4">
      轻量级
     </a>
    </li>
    <li class="toc-h1">
     <a class="" href="#cpu">
      CPU亲和
     </a>
    </li>
   </ul>
  </li>
 </ul>
</div>

		</div>
	</nav>
	<div id="sidebar-tools" class="fixed-container no-active cant-select">
		<!-- 按钮 使用 content 绘制图标 -->
	</div>
	<div id="sidebar-tool-back-top" class="fixed-container cant-select">
		<!-- 按钮 使用 content 绘制图标 -->
	</div>
		</div>

		<!-- Footer Wrapper -->
			<div id="footer-wrapper">
				<!-- Footer -->
					<section id="footer" class="container">
						<div class="row">
							<div class="8u">
								<section>
									<header>
										<h2>Latest articles</h2>
									</header>
									<ul class="dates">
										<li>
											<span class="date">Nov <strong>20</strong></span>
											<h3><a href="yq-docs-rear-end-dart-flutter-tutorial-TextField-h.html">TextField设置高度</a></h3>
											<p><p class="first last">dart-TextField设置高度</p>
</p>
										</li>
										<li>
											<span class="date">Nov <strong>20</strong></span>
											<h3><a href="yq-docs-rear-end-dart-flutter-tutorial-arg-with-callback-fun.html">参数为回调函数</a></h3>
											<p><p class="first last">dart-参数为回调函数</p>
</p>
										</li>
										<li>
											<span class="date">Nov <strong>20</strong></span>
											<h3><a href="yq-docs-rear-end-dart-flutter-tutorial-asset-load.html">Asset资源加载</a></h3>
											<p><p class="first last">dart-Asset资源加载</p>
</p>
										</li>
										<li>
											<span class="date">Nov <strong>20</strong></span>
											<h3><a href="yq-docs-rear-end-dart-flutter-tutorial-circle-img.html">圆角图片</a></h3>
											<p><p class="first last">dart圆角图片</p>
</p>
										</li>
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="4u">
								<section>
									<header>
										<h2>Blogroll</h2>
									</header>
									<ul class="divided">
											<li><a href="https://yq-yqr.readthedocs.io/zh/blog-theme/blog.html">旧版(迁移中)</a></li>
											<li><a href="https://getpelican.com/">Pelican</a></li>
											<li><a href="https://www.python.org/">Python.org</a></li>
											<li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
									</ul>
								</section>
							</div>
							<div class="4u">
								<section>
									<header>
										<h2>Categories</h2>
									</header>
									<ul class="divided">
											<li><a href="/category/ai.html">AI</a></li>
											<li><a href="/category/an-quan.html">安全</a></li>
											<li><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
											<li><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">
								<section>
									<header>
										<h2>SITEMAP</h2>
									</header>

									<ul class="divided">
												<li><a href="/authors.html">作者</a></li>
												<li><a href="/categories.html">分类</a></li>
												<li><a href="/archives.html">归档</a></li>
												<li><a href="/tags.html">标签</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">

								<section>
									<header>
										<h2>Contact</h2>
									</header>
									<ul class="social">
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>&copy; YanQue 2019-2024	</li>
											<!-- <li>Images: <a href="http://facebook.com/DreametryDoodle">Dreametry Doodle</a> + <a href="http://iconify.it">Iconify.it</a></li>
											<li>Design: <a href="http://html5up.net">HTML5 UP</a></li> -->
										</ul>
									</div>
							</div>
						</div>
					</section>
			</div>

		</div>

		<!-- 其他 -->

			<div style="position: fixed;">
				<!-- 深色模式粒子效果 -->
				<!-- <canvas id="universe" width="1428" height="993" data-relingo-block="true" data-relingo-parsed="true"></canvas> -->
				<!-- 深色模式下添加粒子效果canvas -->
				<canvas id="universe" width="1312" height="880"></canvas>
			</div>

		<script src="/theme/js/jquery-3.7.1.min.js"></script>
		<script src="/theme/js/jquery.dropotron.js"></script>
		<script src="/theme/js/config.js"></script>
		<script src="/theme/skel-s0.4.8/skel.min.js"></script>
		<script src="/theme/skel-s0.4.8/skel-panels.min.js"></script>
		<!-- <script src="/theme/js/skel.min.js"></script>
		<script src="/theme/js/skel-panels.min.js"></script> -->
		<script src="/theme/js/backloading.js"></script>
		<script src="/theme/js/canvas/dark.js"></script>
<script type="text/javascript">
	function addEvent() {
		$("#toc-contents-title-text").click(function() {
			$("#top-toc-tree-container").toggleClass("no-active");
			$("#sidebar-tools").toggleClass("no-active");
		})
		$("#sidebar-tools").click(function() {
			$("#top-toc-tree-container").toggleClass("no-active");
			$("#sidebar-tools").toggleClass("no-active");
		})
		$("#sidebar-tool-back-top").click(function() {
			// window.scrollTo(0, 0);
			window.scrollTo({
				top: 0,
				left: 0,
				behavior: 'smooth'
			});
		})
	}
	addEvent()
</script>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="/theme/css/ie8.css" /><![endif]-->
	</body>
</html>