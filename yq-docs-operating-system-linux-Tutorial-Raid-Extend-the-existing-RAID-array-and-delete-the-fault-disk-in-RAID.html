
<!DOCTYPE HTML>
<!--
	Dopetrope 2.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html data-theme="dark">
	<head>
			<title>书言</title>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<meta charset="utf-8" />

			<!-- <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,300italic" rel="stylesheet" /> -->
			<link rel="stylesheet" href="/theme/css/pygment.css" />
			<link rel="stylesheet" href="/theme/css/custom-pygment.css" />
			<noscript>
				<link rel="stylesheet" href="/theme/css/skel-noscript.css" />
				<link rel="stylesheet" href="/theme/css/style.css" />
				<link rel="stylesheet" href="/theme/css/style-desktop.css" />
			</noscript>

		<!-- tipuesearch 放在这, 因为搜索框是全局定义的 -->
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/tipuesearch.css" />
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/custom/tipuesearch-custom.css" />
		<link rel="stylesheet" href="/theme/css/alabaster.css" />
		<!-- <link rel="stylesheet" href="/theme/fontawesome-free-6.5.1-web/css/all.min.css" /> -->
		<!--  <link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-brands-400.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-regular-400.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-solid-900.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-v4compatibility.woff2" /> -->


	</head>
	<body class="no-sidebar">
		<!-- Header Wrapper -->
			<div id="header-wrapper">
				<div class="container">
					<div class="row">
						<div class="12u">

							<!-- Header -->
								<section id="header">

									<!-- Logo -->
									<div class="page-home">
										<h1><a href="/">HOME</a></h1>
									</div>

									<!-- Nav -->
									<div class="page-menu">
										<nav id="nav">
											<ul>

												<!-- categories -->
														<li ><a href="/category/ai.html">AI</a></li>
														<li ><a href="/category/an-quan.html">安全</a></li>
														<li ><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
														<li  class="active"><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
														<li ><a href="/category/chang-yong-gong-ju-shi-yong.html">常用工具使用</a></li>
														<li ><a href="/category/da-shu-ju.html">大数据</a></li>
														<li><a href="/categories.html">More...</a></li>
											</ul>
										</nav>
									</div>
								</section>

						</div>
					</div>
					<div class="row page-head-search">
						<form class="navbar-search" action="/search.html" role="search">
							<!-- <button class="fa-solid fa-magnifying-glass" type="submit"></button> -->
							<button type="submit"></button>
							<input type="text" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
							<!-- <i class="fa-solid fa-magnifying-glass"></i> -->
						</form>
					</div>
  <div class="row page-head page-article persistent">
    <div class="page-head-title">
      <h2>在 RAID 中扩展现有的 RAID 阵列和删除故障的磁盘</h2>
    </div>
    <div class="page-head-content">
      By
	  <a href="author/yanque.html">YanQue</a>
      , 23 二月 2023
      , Category:
	  <a href="category/cao-zuo-xi-tong.html">操作系统</a>
    </div>
	<div class="red-line">
    </div>
  </div>
				</div>
			</div>


		<!-- Main Wrapper -->
			<div id="main-wrapper">
				<div class="container">
<div class="row">
	<div class="12u">
			<section>
				<div>
					<div class="row">
						<div class="12u skel-cell-mainContent">
							<!-- Content -->
								<article class="box is-post">
									<div class="box-head">
										<div class="post-infos">
											<ul class="tags">
												<li><a class="button" href="category/cao-zuo-xi-tong.html">操作系统</a></li>
													<li><a class="button button-alt" href="tag/linux.html">Linux</a></li>

													<li><a class="button button-alt" href="tag/jiao-cheng.html">教程</a></li>

													<li><a class="button button-alt" href="tag/raid.html">Raid</a></li>

											</ul>
										</div>

										<div class="pennant pennant-alt date">2023-02-23</div>
										<h2>在 RAID 中扩展现有的 RAID 阵列和删除故障的磁盘</h2>

										<span class="head-modify-time">修改于: 2023-02-23</span>

									</div>
									<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">参考::</th><td class="field-body"><ul class="first last simple">
<li>作者: <a class="reference external" href="http://www.tecmint.com/grow-raid-array-in-linux/">Babin Lonston</a></li>
<li>译者: <a class="reference external" href="https://linux.cn/lctt/">LCTT</a></li>
<li>译者: <a class="reference external" href="https://linux.cn/lctt/strugglingyouth">struggling</a></li>
<li>评论: <a class="reference external" href="https://linux.cn/portal.php?mod=comment&amp;id=6123&amp;idtype=aid">https://linux.cn/portal.php?mod=comment&amp;id=6123&amp;idtype=aid</a></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>每个新手都会对阵列（array）这个词所代表的意思产生疑惑。
阵列只是磁盘的一个集合。
换句话说，我们可以称阵列为一个集合（set）或一组（group）。
就像一组鸡蛋中包含6个一样。同样 RAID 阵列中包含着多个磁盘，
可能是2，4，6，8，12，16等，希望你现在知道了什么是阵列。</p>
<p>在这里，我们将看到如何扩展现有的阵列或 RAID 组。
例如，如果我们在阵列中使用2个磁盘形成一个 raid 1 集合，
在某些情况，如果该组中需要更多的空间，就可以使用 mdadm -grow 命令来扩展阵列大小，
只需要将一个磁盘加入到现有的阵列中即可。
在说完扩展（添加磁盘到现有的阵列中）后，我们将看看如何从阵列中删除故障的磁盘。</p>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-27-35.png" style="width: 480px;" />
<p class="caption">扩展 RAID 阵列和删除故障的磁盘</p>
</div>
<p>假设磁盘中的一个有问题了需要删除该磁盘，但我们需要在删除磁盘前添加一个备用磁盘来扩展该镜像，
因为我们需要保存我们的数据。当磁盘发生故障时我们需要从阵列中删除它，这是这个主题中我们将要学习到的。</p>
<div class="section" id="raid">
<h2>扩展 RAID 的特性</h2>
<ul class="simple">
<li>我们可以增加（扩展）任意 RAID 集合的大小。</li>
<li>我们可以在使用新磁盘扩展 RAID 阵列后删除故障的磁盘。</li>
<li>我们可以扩展 RAID 阵列而无需停机。</li>
</ul>
</div>
<div class="section" id="section-1">
<h2>要求</h2>
<ul class="simple">
<li>为了扩展一个RAID阵列，我们需要一个已有的 RAID 组（阵列）。</li>
<li>我们需要额外的磁盘来扩展阵列。</li>
<li>在这里，我们使用一块磁盘来扩展现有的阵列。</li>
</ul>
<p>在我们了解扩展和恢复阵列前，我们必须了解有关 RAID 级别和设置的基本知识。点击下面的链接了解这些。</p>
<dl class="docutils">
<dt>原文</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://linux.cn/article-6085-1.html">介绍 RAID 的级别和概念</a></li>
<li><a class="reference external" href="https://linux.cn/article-6087-1.html">使用 mdadm 工具创建软件 RAID 0 （条带化）</a></li>
</ul>
</dd>
</dl>
<p>服务器设置:</p>
<pre class="literal-block">
操作系统    :   CentOS 6.5 Final
IP地址      :   192.168.0.230
主机名      :   grow.tecmintlocal.com
2 块现有磁盘   :   1 GB
1 块额外磁盘   :   1 GB
</pre>
<p>在这里，我们已有一个 RAID ，有2块磁盘，每个大小为1GB，
我们现在再增加一个磁盘到我们现有的 RAID 阵列中，其大小为1GB。</p>
</div>
<div class="section" id="raid-2">
<h2>扩展现有的 RAID 阵列</h2>
<p>在扩展阵列前，首先使用下面的命令列出现有的 RAID 阵列:</p>
<pre class="literal-block">
mdadm --detail /dev/md0
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-29-41.png" style="width: 480px;" />
<p class="caption">检查现有的 RAID 阵列</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">以上输出显示，已经有了两个磁盘在 RAID 阵列中，级别为 RAID 1。现在我们增加一个磁盘到现有的阵列里。</p>
</div>
<p>现在让我们添加新的磁盘“sdd”，并使用 <cite>fdisk</cite> 命令来创建分区:</p>
<pre class="literal-block">
fdisk /dev/sdd
</pre>
<p>请使用以下步骤为 /dev/sdd 创建一个新的分区。</p>
<ul class="simple">
<li>按 <cite>n</cite> 创建新的分区。</li>
<li>然后按 <cite>P</cite> 选择主分区。</li>
<li>接下来选择分区号为1。</li>
<li>只需按两次回车键选择默认值即可。</li>
<li>然后，按 <cite>P</cite> 来打印创建好的分区。</li>
<li>按 <cite>L</cite>，列出所有可用的类型。</li>
<li>按 <cite>t</cite> 去修改分区。</li>
<li>键入 <cite>fd</cite> 设置为 Linux 的 RAID 类型，然后按回车确认。</li>
<li>然后再次使用 <cite>p</cite> 查看我们所做的更改。</li>
<li>使用 <cite>w</cite> 保存更改。</li>
</ul>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-30-38.png" style="width: 480px;" />
<p class="caption">为 sdd 创建新的分区</p>
</div>
<p>一旦新的 sdd 分区创建完成后，你可以使用下面的命令验证它:</p>
<pre class="literal-block">
ls -l /dev/ | grep sd
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-31-14.png" style="width: 480px;" />
<p class="caption">确认 sdd 分区</p>
</div>
<p>接下来，在添加到阵列前先检查磁盘是否有 RAID 分区:</p>
<pre class="literal-block">
mdadm --examine /dev/sdd1
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-31-45.png" style="width: 480px;" />
<p class="caption">在 sdd 分区中检查 RAID</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">以上输出显示，该盘有没有发现 super-blocks，意味着我们可以将新的磁盘添加到现有阵列。</p>
</div>
<p>要添加新的分区 /dev/sdd1 到现有的阵列 md0，请使用以下命令:</p>
<pre class="literal-block">
mdadm --manage /dev/md0 --add /dev/sdd1
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-32-26.png" style="width: 480px;" />
<p class="caption">添加磁盘到 RAID 阵列</p>
</div>
<p>一旦新的磁盘被添加后，在我们的阵列中检查新添加的磁盘:</p>
<pre class="literal-block">
mdadm --detail /dev/md0
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-33-04.png" style="width: 480px;" />
<p class="caption">确认将新磁盘添加到 RAID 中</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">在上面的输出，你可以看到磁盘已经被添加作为备用的。在这里，我们的阵列中已经有了2个磁盘，但我们期待阵列中有3个磁盘，因此我们需要扩展阵列。</p>
</div>
<p>要扩展阵列，我们需要使用下面的命令:</p>
<pre class="literal-block">
mdadm --grow --raid-devices=3 /dev/md0
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-33-44.png" style="width: 480px;" />
<p class="caption">扩展 Raid 阵列</p>
</div>
<p>现在我们可以看到第三块磁盘(sdd1)已被添加到阵列中，在第三块磁盘被添加后，它将从另外两块磁盘上同步数据:</p>
<pre class="literal-block">
mdadm --detail /dev/md0
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-34-22.png" style="width: 480px;" />
<p class="caption">确认 Raid 阵列</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">对于大容量磁盘会需要几个小时来同步数据。在这里，我们使用的是1GB的虚拟磁盘，所以它非常快在几秒钟内便会完成。</p>
</div>
</div>
<div class="section" id="section-2">
<h2>从阵列中删除磁盘</h2>
<p>在数据被从其他两个磁盘同步到新磁盘 <cite>sdd1</cite> 后，现在三个磁盘中的数据已经相同了（镜像）。</p>
<p>正如我前面所说的，假定一个磁盘出问题了需要被删除。所以，现在假设磁盘 <cite>sdc1</cite> 出问题了，需要从现有阵列中删除。</p>
<p>在删除磁盘前我们要将其标记为失效，然后我们才可以将其删除:</p>
<pre class="literal-block">
mdadm --fail /dev/md0 /dev/sdc1### mdadm --detail /dev/md0
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-35-25.png" style="width: 480px;" />
<p class="caption">在 RAID 阵列中模拟磁盘故障*</p>
</div>
<p>从上面的输出中，我们清楚地看到，磁盘在下面被标记为 faulty。
即使它是 faulty 的，我们仍然可以看到 raid 设备有3个，1个损坏了，状态是 degraded。</p>
<p>现在我们要从阵列中删除 faulty 的磁盘，raid 设备将像之前一样继续有2个设备:</p>
<pre class="literal-block">
mdadm --remove /dev/md0 /dev/sdc1
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-35-55.png" style="width: 480px;" />
<p class="caption">在 Raid 阵列中删除磁盘</p>
</div>
<p>一旦故障的磁盘被删除，然后我们只能使用2个磁盘来扩展 raid 阵列了:</p>
<pre class="literal-block">
mdadm --grow --raid-devices=2 /dev/md0### mdadm --detail /dev/md0
</pre>
<div class="figure">
<img alt="as you see" src="doc-raw/resources/images/2024-02-22-17-36-28.png" style="width: 480px;" />
<p class="caption">在 RAID 阵列扩展磁盘</p>
</div>
<p>从上面的输出中可以看到，我们的阵列中仅有2台设备。
如果你需要再次扩展阵列，按照如上所述的同样步骤进行。
如果你需要添加一个磁盘作为备用，将其标记为 spare，因此，如果磁盘出现故障时，它会自动顶上去并重建数据。</p>
</div>
<div class="section" id="section-3">
<h2>结论</h2>
<p>在这篇文章中，我们已经看到了如何扩展现有的 RAID 集合，以及如何在重新同步已有磁盘的数据后从一个阵列中删除故障磁盘。
所有这些步骤都可以不用停机来完成。在数据同步期间，系统用户，文件和应用程序不会受到任何影响。</p>
<p>在接下来的文章我将告诉你如何管理 RAID，敬请关注更新，不要忘了写评论。</p>
</div>

								</article>
						</div>
					</div>
				</div>
			</section>
	</div>
</div>

				</div>
			</div>

		<!-- Sider Bar -->
		<div id="right-side-bar">
	<nav>
		<div id="top-toc-tree-container" class="fixed-container">
			<div class="toc-contents-title">
				<h4 id="toc-contents-title-text">Contents</h4>
				<!-- <span class="tool-tip-text">点击隐藏</span> -->
			</div>
			<div id="toc-tree-container">
 <ul class="toc-tree visible">
  <li class="toc-h0">
   <a class="" href="#raid">
    扩展 RAID 的特性
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#section-1">
    要求
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#raid-2">
    扩展现有的 RAID 阵列
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#section-2">
    从阵列中删除磁盘
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#section-3">
    结论
   </a>
  </li>
 </ul>
</div>

		</div>
	</nav>
	<div id="sidebar-tools" class="fixed-container no-active cant-select">
		<!-- 按钮 使用 content 绘制图标 -->
	</div>
	<div id="sidebar-tool-back-top" class="fixed-container cant-select">
		<!-- 按钮 使用 content 绘制图标 -->
	</div>
		</div>

		<!-- Footer Wrapper -->
			<div id="footer-wrapper">
				<!-- Footer -->
					<section id="footer" class="container">
						<div class="row">
							<div class="8u">
								<section>
									<header>
										<h2>Latest articles</h2>
									</header>
									<ul class="dates">
										<li>
											<span class="date"> 5 <strong>16</strong></span>
											<h3><a href="yq-docs-rear-end-python-Tutorial-Installation-toml-file-operation.html">toml文件操作</a></h3>
											<p><p class="first last">toml文件操作</p>
</p>
										</li>
										<li>
											<span class="date"> 5 <strong>16</strong></span>
											<h3><a href="yq-docs-rear-end-python-python-standard-library-tomlib.html">tomlib</a></h3>
											<p><p class="first last">tomlib</p>
</p>
										</li>
										<li>
											<span class="date"> 5 <strong>16</strong></span>
											<h3><a href="yq-docs-rear-end-python-python-three--party-library-tomli.html">tomli</a></h3>
											<p><p class="first last">tomli</p>
</p>
										</li>
										<li>
											<span class="date"> 5 <strong>16</strong></span>
											<h3><a href="yq-docs-rear-end-python-python-three--party-library-tomli_w.html">tomli_w</a></h3>
											<p><p class="first last">tomli_w</p>
</p>
										</li>
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="4u">
								<section>
									<header>
										<h2>Blogroll</h2>
									</header>
									<ul class="divided">
											<li><a href="https://yq-yqr.readthedocs.io/zh/blog-theme/blog.html">旧版(迁移中)</a></li>
											<li><a href="https://getpelican.com/">Pelican</a></li>
											<li><a href="https://www.python.org/">Python.org</a></li>
											<li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
									</ul>
								</section>
							</div>
							<div class="4u">
								<section>
									<header>
										<h2>Categories</h2>
									</header>
									<ul class="divided">
											<li><a href="/category/ai.html">AI</a></li>
											<li><a href="/category/an-quan.html">安全</a></li>
											<li><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
											<li><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">
								<section>
									<header>
										<h2>SITEMAP</h2>
									</header>

									<ul class="divided">
												<li><a href="/authors.html">作者</a></li>
												<li><a href="/categories.html">分类</a></li>
												<li><a href="/archives.html">归档</a></li>
												<li><a href="/tags.html">标签</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">

								<section>
									<header>
										<h2>Contact</h2>
									</header>
									<ul class="social">
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>&copy; YanQue 2021-2024	</li>
											<!-- <li>Images: <a href="http://facebook.com/DreametryDoodle">Dreametry Doodle</a> + <a href="http://iconify.it">Iconify.it</a></li>
											<li>Design: <a href="http://html5up.net">HTML5 UP</a></li> -->
										</ul>
									</div>
							</div>
						</div>
					</section>
			</div>
		<script src="/theme/js/jquery-3.7.1.min.js"></script>
		<script src="/theme/js/jquery.dropotron.js"></script>
		<script src="/theme/js/config.js"></script>
		<script src="/theme/skel-s0.4.8/skel.min.js"></script>
		<script src="/theme/skel-s0.4.8/skel-panels.min.js"></script>
		<!-- <script src="/theme/js/skel.min.js"></script>
		<script src="/theme/js/skel-panels.min.js"></script> -->
		<script src="/theme/js/backloading.js"></script>
<script type="text/javascript">
	function addEvent() {
		$("#toc-contents-title-text").click(function() {
			$("#top-toc-tree-container").toggleClass("no-active");
			$("#sidebar-tools").toggleClass("no-active");
		})
		$("#sidebar-tools").click(function() {
			$("#top-toc-tree-container").toggleClass("no-active");
			$("#sidebar-tools").toggleClass("no-active");
		})
		$("#sidebar-tool-back-top").click(function() {
			// window.scrollTo(0, 0);
			window.scrollTo({
				top: 0,
				left: 0,
				behavior: 'smooth'
			});
		})
	}
	addEvent()
</script>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="/theme/css/ie8.css" /><![endif]-->
	</body>
</html>