
<!DOCTYPE HTML>
<!--
	Dopetrope 2.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
			<title>书言</title>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<meta charset="utf-8" />
			<link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,300italic" rel="stylesheet" />
				<link rel="stylesheet" href="/theme/css/pygment.css" />
			<noscript>
				<link rel="stylesheet" href="/theme/css/skel-noscript.css" />
				<link rel="stylesheet" href="/theme/css/style.css" />
				<link rel="stylesheet" href="/theme/css/style-desktop.css" />
			</noscript>
		<link rel="stylesheet" href="/theme/css/alabaster.css" />
		<link rel="stylesheet" href="/theme/css/style-update.css" />
	</head>
	<body class="no-sidebar">
		<!-- Header Wrapper -->
			<div id="header-wrapper">
				<div class="container">
					<div class="row">
						<div class="12u">

							<!-- Header -->
								<section id="header">

									<!-- Logo -->
									<div class="page-home">
										<h1><a href="/">HOME</a></h1>
									</div>

									<!-- Nav -->
									<div class="page-menu">
										<nav id="nav">
											<ul>

												<!-- categories -->
														<li ><a href="/category/ai.html">AI</a></li>
														<li ><a href="/category/an-quan.html">安全</a></li>
														<li ><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
														<li  class="active"><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
														<li ><a href="/category/chang-yong-gong-ju-shi-yong.html">常用工具使用</a></li>
														<li ><a href="/category/da-shu-ju.html">大数据</a></li>
														<li><a href="/categories.html">More...</a></li>
											</ul>
										</nav>
									</div>
								</section>

						</div>
					</div>
					<div class="row page-head-search">
						<form class="navbar-search" action="/search.html" role="search">
							<!-- <button class="fa-solid fa-magnifying-glass" type="submit"></button> -->
							<button type="submit"></button>
							<input type="text" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
							<!-- <i class="fa-solid fa-magnifying-glass"></i> -->
						</form>
					</div>
  <div class="row page-head page-article persistent">
    <div class="page-head-title">
      <h2>SSH配置</h2>
    </div>
    <div class="page-head-content">
      By
	  <a href="author/yanque.html">YanQue</a>
      , 27 二月 2023
      , Category:
	  <a href="category/cao-zuo-xi-tong.html">操作系统</a>
    </div>
	<div class="red-line">
    </div>
  </div>
				</div>
			</div>

		<!-- Main Wrapper -->
			<div id="main-wrapper">
				<div class="container">
<div class="row">
	<div class="12u">
			<section>
				<div>
					<div class="row">
						<div class="12u skel-cell-mainContent">
							<!-- Content -->
								<article class="box is-post">
									<div class="post-infos">
										<ul class="tags">
											<li><a class="button" href="category/cao-zuo-xi-tong.html">操作系统</a></li>
												<li><a class="button button-alt" href="tag/linux.html">Linux</a></li>

												<li><a class="button button-alt" href="tag/xi-tong-fu-wu.html">系统服务</a></li>

										</ul>
									</div>

									<div class="pennant pennant-alt date">2023-02-27</div>
									<h2>SSH配置</h2>
									<p>服务器远程访问和工具 (SSH, Secure Shell)</p>
<p><a class="reference external" href="https://zh.wikipedia.org/wiki/Secure_Shell">Secure SHell</a> (SSH)
是因特网上的 <strong>安全</strong> 连接方式。
在 Debian 里面，有一个叫
<a class="reference external" href="http://www.openssh.org/">OpenSSH</a>
的免费 SSH 版本，在 <cite>openssh-client</cite> 和 <cite>openssh-server</cite> 包里。</p>
<p>对于用户来讲, <cite>ssh</cite> 功能比 <cite>telnet</cite> 更加智能和安全.
不像 <cite>telnet</cite> 命令,  <cite>ssh</cite> 命令不会在遇到 <cite>telnet</cite> 的退出字符(初始默认是 CTRL-])时停止.</p>
<div class="section" id="ssh-1">
<h2>SSH 基础</h2>
<p>OpenSSH SSH 后台守护进程（daemon）只支持 SSH 2协议。</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>如果想要运行 OpenSSH 服务， <cite>/etc/ssh/sshd_not_to_be_run</cite> 必须不存在。</p>
<p class="last">不要打开基于 rhost 的认证( <cite>/etc/ssh/sshd_config</cite> 中的 <cite>HostbasedAuthentication</cite> )。</p>
</div>
</div>
<div class="section" id="ssh-2">
<h2>处理其它 SSH 客户端</h2>
<p>其它平台上有一些免费的
<a class="reference external" href="https://zh.wikipedia.org/wiki/Secure_Shell">SSH</a> 客户端。</p>
<p>其它平台上免费 SSH 客户端列表:</p>
<pre class="literal-block">
环境                  免费 SSH 程序
Windows               puTTY (http://www.chiark.greenend.org.uk/~sgtatham/putty/) (GPL)
Windows (cygwin)      cygwin 里的 SSH (http://www.cygwin.com/) (GPL)
Macintosh 类          macSSH (http://www.macssh.com/) (GPL)
Mac OS X              OpenSSH;在终端应用中使用 ssh (GPL)
</pre>
</div>
<div class="section" id="ssh-4">
<h2>建立 ssh 代理</h2>
<p>用密码来保护你的 SSH 认证私钥是安全的。
如果密码没有设置，使用 <cite>ssh-keygen -p</cite> 来设置。
把你的公钥 (比如： <cite>~/.ssh/id_rsa.pub</cite> ) 放到远程主机的
<cite>~/.ssh/authorized_keys</cite> ，这个远程主机使用上面描述的基于密码的连接方式:</p>
<pre class="literal-block">
$ ssh-agent bash
$ ssh-add ~/.ssh/id_rsa Enter passphrase for /home/*username*/.ssh/id_rsa: Identity added: /home/*username*/.ssh/id_rsa (/home/*username*/.ssh/id_rsa)
</pre>
<!-- 可参考 :doc:`ssh-agent` -->
<p>从这里执行接下来的命令，就不再需要密码:</p>
<pre class="literal-block">
$ scp foo username&#64;remote.host:foo
</pre>
<p>按 ^D 来终结 ssh 代理会话。</p>
<p>对于 X 服务端， 通常的 Debian 启动脚本会作为父进程执行 <cite>ssh-agent</cite> 。
所以你只需要执行一次 <cite>ssh-add</cite> 。进一步的信息，请阅读 <cite>ssh-agent</cite> 和 <cite>ssh-add</cite> .</p>
</div>
<div class="section" id="ssh-5">
<h2>怎样通过 SSH 关闭远程系统</h2>
<p>你可以使用 <cite>at</cite> 命令
(参见 <a class="reference external" href="https://www.debian.org/doc/manuals/debian-reference/ch09.zh-cn.html###_scheduling_tasks_once">第 9.4.13 节 “单次任务时间安排”</a> )
来从 SSH 终端里保护 <cite>shutdown -h now</cite>
(参见 <a class="reference external" href="https://www.debian.org/doc/manuals/debian-reference/ch01.zh-cn.html###_how_to_shutdown_the_system">第 1.1.8 节 “怎样关闭系统”</a>
操作过程:</p>
<pre class="literal-block">
### echo &quot;shutdown -h now&quot; | at now
</pre>
</div>
<div class="section" id="ssh-6">
<h2>SSH 故障排查</h2>
<p>如果你遇到问题，检查配置文件的权限并用 <cite>-v</cite> 选项运行 <cite>ssh</cite></p>
<p>如果你是 root 账户，并有使用防火墙，使用 <cite>-p</cite> 选项;
这可以避免使用1 — 1023 之间的服务端口.</p>
<p>如果 <cite>ssh</cite> 连接到远程站点突然停止工作，这也许是系统管理员胡乱操作的结果，
可能是在系统维护时改变了  <cite>host_key</cite> .
在确认这个情况后，并且没有人试图用聪明的黑客技术来篡改远程主机，
你可以在本机 <cite>~/.ssh/known_hosts</cite> 里删除 <cite>host_key</cite> 条目来重新获得连接</p>
</div>
<div class="section" id="section-1">
<h2>设置会话过期</h2>
<p>设置会话过期:</p>
<pre class="literal-block">
# /etc/ssh/sshd_config

ServerAliveInterval 60        # 单次发送包检查链接时间，单位是秒，为0表示不发
ServerAliveCountMax 30        # 最大检查次数，超过后断开链接
</pre>
<dl class="docutils">
<dt>ClientAliveInterval</dt>
<dd>这个其实就是SSH Server与Client的心跳超时时间，
也就是说，当客户端没有指令过来，
Server间隔`ClientAliveInterval`的时间（单位秒）会发一个空包到Client来维持心跳，
60表示每分钟发送一次，然后客户端响应，这样就保持长连接了保证Session有效, 默认是0, 不发送;</dd>
<dt>ClientAliveCountMax</dt>
<dd>当心跳包发送失败时重试的次数，比如现在我们设置成了30，
如果Server向Client连续发30次心跳包都失败了，就会断开这个session连接。</dd>
</dl>
<p>另一个地方:</p>
<pre class="literal-block">
# /etc/profile
TMOUT=60    # 空闲等待时间，默认值0，表示不超时
</pre>
</div>
<div class="section" id="ssh-7">
<h2>ssh的时候定义别名</h2>
<div class="section" id="ssh-8">
<h3>方法 1 – 使用 SSH 配置文件</h3>
<p>这是我创建别名的首选方法。</p>
<p>我们可以使用 SSH 默认配置文件来创建 SSH 别名。为此，
编辑 <cite>~/.ssh/config</cite> 文件（如果此文件不存在，只需创建一个）:</p>
<pre class="literal-block">
$ vi ~/.ssh/config
</pre>
<p>添加所有远程主机的详细信息，如下所示:</p>
<pre class="literal-block">
Host webserver
    HostName 192.168.225.22
    User sk

Host dns
    HostName server.example.com
    User root

Host dhcp
    HostName 192.168.225.25
    User ostechnix
    Port 2233
</pre>
</div>
<div class="section" id="bash">
<h3>方法 2 – 使用 Bash 别名</h3>
<p>这是创建 SSH 别名的一种应急变通的方法，可以加快通信的速度。
你可以使用 <em>/docs/操作系统/linux/linux指令/alias</em> 使这项任务更容易。</p>
<p>打开 <cite>~/.bashrc</cite> 或者 <cite>~/.bash_profile</cite> 文件:</p>
<pre class="literal-block">
alias webserver='ssh sk&#64;server.example.com'
alias dns='ssh sk&#64;server.example.com'
alias dhcp='ssh sk&#64;server.example.com -p 2233'
alias ubuntu='ssh sk&#64;server.example.com -i ~/.ssh/id_rsa_remotesystem'
</pre>
<p>再次确保你已使用自己的值替换主机、主机名、端口号和 IP 地址。保存文件并退出。</p>
<p>然后，使用命令应用更改:</p>
<pre class="literal-block">
$ source ~/.bashrc
</pre>
<p>或者:</p>
<pre class="literal-block">
$ source ~/.bash_profile
</pre>
<p>在此方法中，你甚至不需要使用 <cite>ssh 别名</cite> 命令。相反，只需使用别名，如下所示。</p>
<blockquote>
$ webserver
$ dns
$ dhcp
$ ubuntu</blockquote>
<p><strong>（方法2太慢了 alias debian9=“user&#64;host” 然后 ssh debian9 太慢了 ）</strong></p>
</div>
</div>

								</article>
						</div>
					</div>
				</div>
			</section>
	</div>
</div>

				</div>
			</div>

		<!-- Footer Wrapper -->
			<div id="footer-wrapper">
				<!-- Footer -->
					<section id="footer" class="container">
						<div class="row">
							<div class="8u">
								<section>
									<header>
										<h2>Latest articles</h2>
									</header>
									<ul class="dates">
										<li>
											<span class="date"> 3 <strong>21</strong></span>
											<h3><a href="yq-doc-source-docs-front-end-frame-jquery-jQuery-provided-methods.html">jQuery提供方法</a></h3>
											<p><p class="first last">jQuery提供常用方法/函数</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>19</strong></span>
											<h3><a href="yq-doc-source-docs-version-control-git-issuses-clone-only-folder.html">仅克隆指定文件夹</a></h3>
											<p><p class="first last">当前模块或子模块仅克隆指定文件夹</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>19</strong></span>
											<h3><a href="yq-doc-source-docs-rear-end-python-python-three--party-library-googletrans.html">googletrans</a></h3>
											<p><p class="first last">python实现翻译功能</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>18</strong></span>
											<h3><a href="yq-os-linux-ubuntu-issues.html">gnome刷新desktop缓存</a></h3>
											<p><p class="first last">gnome图标文件缓存刷新</p>
</p>
										</li>
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="4u">
								<section>
									<header>
										<h2>Blogroll</h2>
									</header>
									<ul class="divided">
											<li><a href="https://yq-yqr.readthedocs.io/zh/blog-theme/blog.html">旧版(迁移中)</a></li>
											<li><a href="https://getpelican.com/">Pelican</a></li>
											<li><a href="https://www.python.org/">Python.org</a></li>
											<li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
									</ul>
								</section>
							</div>
							<div class="4u">
								<section>
									<header>
										<h2>Categories</h2>
									</header>
									<ul class="divided">
											<li><a href="/category/ai.html">AI</a></li>
											<li><a href="/category/an-quan.html">安全</a></li>
											<li><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
											<li><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">
								<section>
									<header>
										<h2>SITEMAP</h2>
									</header>

									<ul class="divided">
												<li><a href="/authors.html">作者</a></li>
												<li><a href="/categories.html">分类</a></li>
												<li><a href="/archives.html">归档</a></li>
												<li><a href="/tags.html">标签</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">

								<section>
									<header>
										<h2>Contact</h2>
									</header>
									<ul class="social">
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>&copy; YanQue 2021-2024	</li>
											<!-- <li>Images: <a href="http://facebook.com/DreametryDoodle">Dreametry Doodle</a> + <a href="http://iconify.it">Iconify.it</a></li>
											<li>Design: <a href="http://html5up.net">HTML5 UP</a></li> -->
										</ul>
									</div>
							</div>
						</div>
					</section>
			</div>
		<script src="/theme/js/jquery.min.js"></script>
		<script src="/theme/js/jquery.dropotron.js"></script>
		<script src="/theme/js/config.js"></script>
		<script src="/theme/js/skel.min.js"></script>
		<script src="/theme/js/skel-panels.min.js"></script>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="/theme/css/ie8.css" /><![endif]-->
	</body>
</html>