
<!DOCTYPE HTML>
<!--
	Dopetrope 2.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
			<title>书言</title>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<meta charset="utf-8" />

			<!-- <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,300italic" rel="stylesheet" /> -->
			<link rel="stylesheet" href="/theme/css/pygment.css" />
			<link rel="stylesheet" href="/theme/css/custom-pygment.css" />
			<noscript>
				<link rel="stylesheet" href="/theme/css/skel-noscript.css" />
				<link rel="stylesheet" href="/theme/css/style.css" />
				<link rel="stylesheet" href="/theme/css/style-desktop.css" />
			</noscript>

		<!-- tipuesearch 放在这, 因为搜索框是全局定义的 -->
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/tipuesearch.css" />
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/custom/tipuesearch-custom.css" />
		<link rel="stylesheet" href="/theme/css/alabaster.css" />
		<!-- <link rel="stylesheet" href="/theme/fontawesome-free-6.5.1-web/css/all.min.css" /> -->
		<!--  <link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-brands-400.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-regular-400.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-solid-900.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-v4compatibility.woff2" /> -->


	</head>
	<body class="no-sidebar">
		<!-- Header Wrapper -->
			<div id="header-wrapper">
				<div class="container">
					<div class="row">
						<div class="12u">

							<!-- Header -->
								<section id="header">

									<!-- Logo -->
									<div class="page-home">
										<h1><a href="/">HOME</a></h1>
									</div>

									<!-- Nav -->
									<div class="page-menu">
										<nav id="nav">
											<ul>

												<!-- categories -->
														<li ><a href="/category/ai.html">AI</a></li>
														<li ><a href="/category/an-quan.html">安全</a></li>
														<li ><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
														<li ><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
														<li ><a href="/category/chang-yong-gong-ju-shi-yong.html">常用工具使用</a></li>
														<li ><a href="/category/da-shu-ju.html">大数据</a></li>
														<li><a href="/categories.html">More...</a></li>
											</ul>
										</nav>
									</div>
								</section>

						</div>
					</div>
					<div class="row page-head-search">
						<form class="navbar-search" action="/search.html" role="search">
							<!-- <button class="fa-solid fa-magnifying-glass" type="submit"></button> -->
							<button type="submit"></button>
							<input type="text" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
							<!-- <i class="fa-solid fa-magnifying-glass"></i> -->
						</form>
					</div>
  <div class="row page-head page-article persistent">
    <div class="page-head-title">
      <h2>XPath选择器</h2>
    </div>
    <div class="page-head-content">
      By
	  <a href="author/yanque.html">YanQue</a>
      , 01 March 2023
      , Category:
	  <a href="category/hou-duan.html">后端</a>
    </div>
	<div class="red-line">
    </div>
  </div>
				</div>
			</div>


		<!-- Main Wrapper -->
			<div id="main-wrapper">
				<div class="container">
<div class="row">
	<div class="12u">
			<section>
				<div>
					<div class="row">
						<div class="12u skel-cell-mainContent">
							<!-- Content -->
								<article class="box is-post">
									<div class="post-infos">
										<ul class="tags">
											<li><a class="button" href="category/hou-duan.html">后端</a></li>
												<li><a class="button button-alt" href="tag/python.html">Python</a></li>

												<li><a class="button button-alt" href="tag/pythonsan-fang-ku.html">Python三方库</a></li>

												<li><a class="button button-alt" href="tag/scrapy.html">Scrapy</a></li>

												<li><a class="button button-alt" href="tag/xuan-ze-qi.html">选择器</a></li>

										</ul>
									</div>

									<div class="pennant pennant-alt date">2023-03-01</div>
									<h2>XPath选择器</h2>
									<p>XPath 参考 <a class="reference external" href="/yq-docs-rear-end-python-Tutorial-XPath-index.html">index</a></p>
<p>概述:</p>
<pre class="literal-block">
text()            获取文本
&#64;属性名           获取指定属性, 不跟表达式仅表示存在当前属性

has-class         是否包含指定class
                  has-class(&quot;cl1&quot;)      是否包含 class属性 cl1 (仅Scrapy支持)
</pre>
<p>如有以下HTML:</p>
<pre class="literal-block">
&lt;!DOCTYPE html&gt;

&lt;html&gt;
  &lt;head&gt;
    &lt;base href='http://example.com/' /&gt;
    &lt;title&gt;Example website&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id='images'&gt;
      &lt;a href='image1.html'&gt;Name: My image 1 &lt;br /&gt;&lt;img src='image1_thumb.jpg' alt='image1'/&gt;&lt;/a&gt;
      &lt;a href='image2.html'&gt;Name: My image 2 &lt;br /&gt;&lt;img src='image2_thumb.jpg' alt='image2'/&gt;&lt;/a&gt;
      &lt;a href='image3.html'&gt;Name: My image 3 &lt;br /&gt;&lt;img src='image3_thumb.jpg' alt='image3'/&gt;&lt;/a&gt;
      &lt;a href='image4.html'&gt;Name: My image 4 &lt;br /&gt;&lt;img src='image4_thumb.jpg' alt='image4'/&gt;&lt;/a&gt;
      &lt;a href='image5.html'&gt;Name: My image 5 &lt;br /&gt;&lt;img src='image5_thumb.jpg' alt='image5'/&gt;&lt;/a&gt;
    &lt;/div&gt;
    &lt;div class='cl1 cl2'&gt;
      Name: My image 5 &lt;br /&gt;
      &lt;img src='image5_thumb.jpg' alt='image5'/&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>选择title的内容:</p>
<pre class="literal-block">
//title/text()
</pre>
<p>获取所有 a 标签的内容:</p>
<pre class="literal-block">
//div[&#64;id=&quot;images&quot;]/a/text()
</pre>
<p>包含使用 contains</p>
<pre class="literal-block">
contains(&#64;id, &quot;images&quot;)
</pre>
<p>比如有多个class属性的时候, =是不成立的, 只好用 contains,
参考 <em>XpathContain</em>:</p>
<pre class="literal-block">
//div[contains(&#64;class, &quot;cl1&quot;)]/img/&#64;src
</pre>
<p>可以发现使用 contains 是比较麻烦的,
且不易兼容所有情况,
所以有时还是使用 <a class="reference external" href="/yq-docs-rear-end-python-python-three--party-library-Scrapy-Selector-CSS-selector.html">CSS选择器</a>
更简单:</p>
<pre class="literal-block">
.css(&quot;div.cl1&quot;).xpath(&quot;./img/&#64;src&quot;)
</pre>
<p>可参考 <a class="reference external" href="/yq-docs-rear-end-python-Tutorial-XPath-Xpath-operator.html">XPath运算符</a></p>
<div class="section" id="section-1">
<h2>加不加括号的区别</h2>
<p>举例:</p>
<pre class="literal-block">
&lt;ul class=&quot;list&quot;&gt;
    &lt;li&gt;1&lt;/li&gt;
    &lt;li&gt;2&lt;/li&gt;
    &lt;li&gt;3&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;list&quot;&gt;
    &lt;li&gt;4&lt;/li&gt;
    &lt;li&gt;5&lt;/li&gt;
    &lt;li&gt;6&lt;/li&gt;
&lt;/ul&gt;
</pre>
<p>不加括号(选择所有组节点):</p>
<pre class="literal-block">
//li[1]
//ul/li[1]

# 结果都是
['&lt;li&gt;1&lt;/li&gt;', '&lt;li&gt;4&lt;/li&gt;']
</pre>
<p>加括号(将所有组合并一个组):</p>
<pre class="literal-block">
(//li)[1]
(//ul/li)[1]

# 结果都是
['&lt;li&gt;1&lt;/li&gt;']
</pre>
</div>
<div class="section" id="text">
<h2>条件表达式下使用text</h2>
<p>应该避免直接使用:</p>
<pre class="literal-block">
.//text()
</pre>
<p>而是使用:</p>
<pre class="literal-block">
.
</pre>
<p>因为前者在Scrapy框架会返回一个包含所有text文本的生成器结果集(yield []),
然后当其作为参数传递给 str的函数比如  contains(), starts-with(),
只会返回第一个结果</p>
<p>比如:</p>
<pre class="literal-block">
&gt;&gt;&gt; from scrapy import Selector
&gt;&gt;&gt; sel = Selector(
...     text='&lt;a href=&quot;#&quot;&gt;Click here to go to the &lt;strong&gt;Next Page&lt;/strong&gt;&lt;/a&gt;'
... )
</pre>
<p>转换为 String 的结果集:</p>
<pre class="literal-block">
&gt;&gt;&gt; sel.xpath(&quot;//a//text()&quot;).getall()  # take a peek at the node-set
['Click here to go to the ', 'Next Page']
&gt;&gt;&gt; sel.xpath(&quot;string(//a[1]//text())&quot;).getall()  # convert it to string
['Click here to go to the ']
</pre>
<p>转换为字符串的节点会丢失后代节点:</p>
<pre class="literal-block">
&gt;&gt;&gt; sel.xpath(&quot;//a[1]&quot;).getall()  # select the first node
['&lt;a href=&quot;#&quot;&gt;Click here to go to the &lt;strong&gt;Next Page&lt;/strong&gt;&lt;/a&gt;']
&gt;&gt;&gt; sel.xpath(&quot;string(//a[1])&quot;).getall()  # convert it to string, 丢失了后代
['Click here to go to the Next Page']
</pre>
<p>这时使用 <tt class="docutils literal"><span class="pre">.//text()</span></tt> 得不到任何结果:</p>
<pre class="literal-block">
&gt;&gt;&gt; sel.xpath(&quot;//a[contains(.//text(), 'Next Page')]&quot;).getall()
[]
</pre>
<p>但如果使用 <tt class="docutils literal">.</tt> , 就可获取到:</p>
<pre class="literal-block">
&gt;&gt;&gt; sel.xpath(&quot;//a[contains(., 'Next Page')]&quot;).getall()
['&lt;a href=&quot;#&quot;&gt;Click here to go to the &lt;strong&gt;Next Page&lt;/strong&gt;&lt;/a&gt;']
</pre>
</div>
<div class="section" id="xpath-1">
<h2>XPath表达式变量</h2>
<p>XPath 允许你在表达式中引用变量, 语法:</p>
<pre class="literal-block">
$varName
</pre>
<p>与SQL类似, 还支持使用 <tt class="docutils literal">?</tt> 占位符, 来做变量替换:</p>
<pre class="literal-block">
&gt;&gt;&gt; # `$val` used in the expression, a `val` argument needs to be passed
&gt;&gt;&gt; response.xpath(&quot;//div[&#64;id=$val]/a/text()&quot;, val=&quot;images&quot;).get()
'Name: My image 1 '
</pre>
<p>又比如寻找 div 下包含 5 个孩子节点:</p>
<pre class="literal-block">
&gt;&gt;&gt; response.xpath(&quot;//div[count(a)=$cnt]/&#64;id&quot;, cnt=5).get()
'images'
</pre>
<p>任何变量必须使用的时候就给定值, 否则会报错 <tt class="docutils literal">ValueError: XPath error: exception</tt></p>
</div>
<div class="section" id="section-2">
<h2>移除命名空间</h2>
<p>有些爬虫项目获取到的 HTML/XML 是存在命名空间的,
但是我们并不关注这个, 只想处理元素,
所以可以直接移除:</p>
<pre class="literal-block">
Selector.remove_namespaces()
</pre>
<p>比如以下的XML:</p>
<pre class="literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;?xml-stylesheet ...
&lt;feed xmlns=&quot;http://www.w3.org/2005/Atom&quot;
      xmlns:openSearch=&quot;http://a9.com/-/spec/opensearchrss/1.0/&quot;
      xmlns:blogger=&quot;http://schemas.google.com/blogger/2008&quot;
      xmlns:georss=&quot;http://www.georss.org/georss&quot;
      xmlns:gd=&quot;http://schemas.google.com/g/2005&quot;
      xmlns:thr=&quot;http://purl.org/syndication/thread/1.0&quot;
      xmlns:feedburner=&quot;http://rssnamespace.org/feedburner/ext/1.0&quot;&gt;
  ...
</pre>
<p>有一个默认的 <tt class="docutils literal"><span class="pre">http://www.w3.org/2005/Atom</span></tt> 和其他的
比如 <tt class="docutils literal">gd:” prefix for <span class="pre">“http://schemas.google.com/g/2005”</span></tt></p>
<p>当尝试选择 link 时, 获取不到结果:</p>
<pre class="literal-block">
&gt;&gt;&gt; response.xpath(&quot;//link&quot;)
[]
</pre>
<p>因为其存在于默认的命名空间内.
移除掉即可:</p>
<pre class="literal-block">
&gt;&gt;&gt; response.selector.remove_namespaces()
&gt;&gt;&gt; response.xpath(&quot;//link&quot;)
[&lt;Selector query='//link' data='&lt;link rel=&quot;alternate&quot; type=&quot;text/html&quot; h'&gt;,
    &lt;Selector query='//link' data='&lt;link rel=&quot;next&quot; type=&quot;application/atom+'&gt;,
    ...
</pre>
<dl class="docutils">
<dt>为什么默认不直接移除?</dt>
<dd><ul class="first last simple">
<li>移除对整个文档所有节点操作, 代价大</li>
<li>并非所有情况下都不会用到 namespace</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="exslt">
<h2>使用 EXSLT 拓展</h2>
<p>Scrapy选择器构建在lxml之上，支持一些EXCIBLE扩展，
并带有这些预注册的命名空间，可用于EXCIBLE表达式：</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="56%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">prefix</th>
<th class="head">namespace</th>
<th class="head">usage</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>re</td>
<td><a class="reference external" href="http://exslt.org/regular-expressions">http://exslt.org/regular-expressions</a></td>
<td>正则表达式</td>
</tr>
<tr><td>set</td>
<td><a class="reference external" href="http://exslt.org/sets">http://exslt.org/sets</a></td>
<td>集合操作
(set manipulation)</td>
</tr>
</tbody>
</table>
<div class="section" id="section-3">
<h3>正则表达式支持</h3>
<p>默认 XPath 有提供字符串的 <tt class="docutils literal"><span class="pre">starts-with()</span></tt> 和  <tt class="docutils literal">contains()</tt> 方法,
但是更复杂的匹配就不行了,  这时可以用 <tt class="docutils literal">test()</tt> 方法</p>
<p>比如选择指定 class 的 li 标签下的 链接:</p>
<pre class="literal-block">
&gt;&gt;&gt; from scrapy import Selector
&gt;&gt;&gt; doc = &quot;&quot;&quot;
... &lt;div&gt;
...     &lt;ul&gt;
...         &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;
...         &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;
...         &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt;
...         &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;
...         &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;&lt;/li&gt;
...     &lt;/ul&gt;
... &lt;/div&gt;
... &quot;&quot;&quot;
&gt;&gt;&gt; sel = Selector(text=doc, type=&quot;html&quot;)
&gt;&gt;&gt; sel.xpath(&quot;//li//&#64;href&quot;).getall()
['link1.html', 'link2.html', 'link3.html', 'link4.html', 'link5.html']
&gt;&gt;&gt; sel.xpath('//li[re:test(&#64;class, &quot;item-\d$&quot;)]//&#64;href').getall()
['link1.html', 'link2.html', 'link4.html', 'link5.html']
</pre>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>C库的 <tt class="docutils literal">libxslt</tt> 并不提供 EXSLT 的支持,
所以实际上匹配使用的是 Python 的 <a class="reference external" href="/yq-docs-rear-end-python-python-standard-library-hot.html">re</a> .</p>
<p class="last">故, 存在性能问题是无法避免的</p>
</div>
</div>
<div class="section" id="section-4">
<h3>集合操作</h3>
<!-- Set operations -->
<!-- set manipulation -->
<p>有时候可能不想要文档的某个部分</p>
<p>比如 <a class="reference external" href="https://schema.org/Product">https://schema.org/Product</a> 的以下内容, 存在
itemscopes 和 corresponding itemprops:</p>
<pre class="literal-block">
&gt;&gt;&gt; doc = &quot;&quot;&quot;
... &lt;div itemscope itemtype=&quot;http://schema.org/Product&quot;&gt;
...   &lt;span itemprop=&quot;name&quot;&gt;Kenmore White 17&quot; Microwave&lt;/span&gt;
...   &lt;img src=&quot;kenmore-microwave-17in.jpg&quot; alt='Kenmore 17&quot; Microwave' /&gt;
...   &lt;div itemprop=&quot;aggregateRating&quot;
...     itemscope itemtype=&quot;http://schema.org/AggregateRating&quot;&gt;
...    Rated &lt;span itemprop=&quot;ratingValue&quot;&gt;3.5&lt;/span&gt;/5
...    based on &lt;span itemprop=&quot;reviewCount&quot;&gt;11&lt;/span&gt; customer reviews
...   &lt;/div&gt;
...   &lt;div itemprop=&quot;offers&quot; itemscope itemtype=&quot;http://schema.org/Offer&quot;&gt;
...     &lt;span itemprop=&quot;price&quot;&gt;$55.00&lt;/span&gt;
...     &lt;link itemprop=&quot;availability&quot; href=&quot;http://schema.org/InStock&quot; /&gt;In stock
...   &lt;/div&gt;
...   Product description:
...   &lt;span itemprop=&quot;description&quot;&gt;0.7 cubic feet countertop microwave.
...   Has six preset cooking categories and convenience features like
...   Add-A-Minute and Child Lock.&lt;/span&gt;
...   Customer reviews:
...   &lt;div itemprop=&quot;review&quot; itemscope itemtype=&quot;http://schema.org/Review&quot;&gt;
...     &lt;span itemprop=&quot;name&quot;&gt;Not a happy camper&lt;/span&gt; -
...     by &lt;span itemprop=&quot;author&quot;&gt;Ellie&lt;/span&gt;,
...     &lt;meta itemprop=&quot;datePublished&quot; content=&quot;2011-04-01&quot;&gt;April 1, 2011
...     &lt;div itemprop=&quot;reviewRating&quot; itemscope itemtype=&quot;http://schema.org/Rating&quot;&gt;
...       &lt;meta itemprop=&quot;worstRating&quot; content = &quot;1&quot;&gt;
...       &lt;span itemprop=&quot;ratingValue&quot;&gt;1&lt;/span&gt;/
...       &lt;span itemprop=&quot;bestRating&quot;&gt;5&lt;/span&gt;stars
...     &lt;/div&gt;
...     &lt;span itemprop=&quot;description&quot;&gt;The lamp burned out and now I have to replace
...     it. &lt;/span&gt;
...   &lt;/div&gt;
...   &lt;div itemprop=&quot;review&quot; itemscope itemtype=&quot;http://schema.org/Review&quot;&gt;
...     &lt;span itemprop=&quot;name&quot;&gt;Value purchase&lt;/span&gt; -
...     by &lt;span itemprop=&quot;author&quot;&gt;Lucas&lt;/span&gt;,
...     &lt;meta itemprop=&quot;datePublished&quot; content=&quot;2011-03-25&quot;&gt;March 25, 2011
...     &lt;div itemprop=&quot;reviewRating&quot; itemscope itemtype=&quot;http://schema.org/Rating&quot;&gt;
...       &lt;meta itemprop=&quot;worstRating&quot; content = &quot;1&quot;/&gt;
...       &lt;span itemprop=&quot;ratingValue&quot;&gt;4&lt;/span&gt;/
...       &lt;span itemprop=&quot;bestRating&quot;&gt;5&lt;/span&gt;stars
...     &lt;/div&gt;
...     &lt;span itemprop=&quot;description&quot;&gt;Great microwave for the price. It is small and
...     fits in my apartment.&lt;/span&gt;
...   &lt;/div&gt;
...   ...
... &lt;/div&gt;
... &quot;&quot;&quot;
&gt;&gt;&gt; sel = Selector(text=doc, type=&quot;html&quot;)
&gt;&gt;&gt; for scope in sel.xpath(&quot;//div[&#64;itemscope]&quot;):
...     print(&quot;current scope:&quot;, scope.xpath(&quot;&#64;itemtype&quot;).getall())
...     props = scope.xpath(
...         &quot;&quot;&quot;
...                 set:difference(./descendant::*/&#64;itemprop,
...                                .//*[&#64;itemscope]/*/&#64;itemprop)&quot;&quot;&quot;
...     )
...     print(f&quot;    properties: {props.getall()}&quot;)
...     print(&quot;&quot;)
...

current scope: ['http://schema.org/Product']
    properties: ['name', 'aggregateRating', 'offers', 'description', 'review', 'review']

current scope: ['http://schema.org/AggregateRating']
    properties: ['ratingValue', 'reviewCount']

current scope: ['http://schema.org/Offer']
    properties: ['price', 'availability']

current scope: ['http://schema.org/Review']
    properties: ['name', 'author', 'datePublished', 'reviewRating', 'description']

current scope: ['http://schema.org/Rating']
    properties: ['worstRating', 'ratingValue', 'bestRating']

current scope: ['http://schema.org/Review']
    properties: ['name', 'author', 'datePublished', 'reviewRating', 'description']

current scope: ['http://schema.org/Rating']
    properties: ['worstRating', 'ratingValue', 'bestRating']
</pre>
<p>主要是:</p>
<pre class="literal-block">
set:difference(./descendant::*/&#64;itemprop, .//*[&#64;itemscope]/*/&#64;itemprop)
</pre>
<p><tt class="docutils literal">set:difference</tt> 表示使用一个集合减去另一个集合, 也就是:</p>
<pre class="literal-block">
./descendant::*/&#64;itemprop
</pre>
<p>减去:</p>
<pre class="literal-block">
.//*[&#64;itemscope]/*/&#64;itemprop
</pre>
<p>来分别看分析这两个的含义:</p>
<pre class="literal-block">
./descendant::*/&#64;itemprop
  descendant 翻译过来就是后代,
  这里就是表示当前元素的所有后代元素(后代, 孙代...),

  总来说就是, 所有后代元素的 itemprop 属性


.//*[&#64;itemscope]/*/&#64;itemprop
  选择所有包含 itemscope 属性的 itemprop 属性
</pre>
<p>整个表达式的含义是选择当前节点的所有后代节点中具有 itemprop 属性的属性节点，
然后从中排除当前节点下具有 itemscope 属性的元素节点的子节点中的 itemprop 属性节点，
最后返回剩余的元素节点集合</p>
</div>
</div>
<div class="section" id="xpath-2">
<h2>其他 XPath 拓展</h2>
<p>Scrapy 选择器 还提供了 <tt class="docutils literal"><span class="pre">has-class</span></tt>, 可用于判断是否包含 class 属性,</p>
<p>对于HTML:</p>
<pre class="literal-block">
&gt;&gt;&gt; from scrapy.http import HtmlResponse
&gt;&gt;&gt; response = HtmlResponse(
...     url=&quot;http://example.com&quot;,
...     body=&quot;&quot;&quot;
... &lt;html&gt;
...     &lt;body&gt;
...         &lt;p class=&quot;foo bar-baz&quot;&gt;First&lt;/p&gt;
...         &lt;p class=&quot;foo&quot;&gt;Second&lt;/p&gt;
...         &lt;p class=&quot;bar&quot;&gt;Third&lt;/p&gt;
...         &lt;p&gt;Fourth&lt;/p&gt;
...     &lt;/body&gt;
... &lt;/html&gt;
... &quot;&quot;&quot;,
...     encoding=&quot;utf-8&quot;,
... )
</pre>
<p>这样用:</p>
<pre class="literal-block">
&gt;&gt;&gt; response.xpath('//p[has-class(&quot;foo&quot;)]')
[&lt;Selector query='//p[has-class(&quot;foo&quot;)]' data='&lt;p class=&quot;foo bar-baz&quot;&gt;First&lt;/p&gt;'&gt;,
&lt;Selector query='//p[has-class(&quot;foo&quot;)]' data='&lt;p class=&quot;foo&quot;&gt;Second&lt;/p&gt;'&gt;]
&gt;&gt;&gt; response.xpath('//p[has-class(&quot;foo&quot;, &quot;bar-baz&quot;)]')
[&lt;Selector query='//p[has-class(&quot;foo&quot;, &quot;bar-baz&quot;)]' data='&lt;p class=&quot;foo bar-baz&quot;&gt;First&lt;/p&gt;'&gt;]
&gt;&gt;&gt; response.xpath('//p[has-class(&quot;foo&quot;, &quot;bar&quot;)]')
[]
</pre>
<p>其中:</p>
<pre class="literal-block">
//p[has-class(&quot;foo&quot;, &quot;bar-baz&quot;)]
</pre>
<p>相当于 CSS的:</p>
<pre class="literal-block">
p.foo.bar-baz
</pre>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p>has-class 其实性能是比较慢的, 因为它是一个纯 Python 函数.</p>
<p class="last">故建议仅适用于, CSS选择器不容易描述的情况下</p>
</div>
</div>
<div class="section" id="python">
<h2>添加自定义 Python 方法</h2>
<p>API:</p>
<pre class="literal-block">
parsel.xpathfuncs.set_xpathfunc(fname: str, func: Optional[Callable]) -&gt; None[source]
</pre>
<p>用于注册自定义 XPath 表达式方法</p>
<p>Register a custom extension function to use in XPath expressions.</p>
<dl class="docutils">
<dt>fname</dt>
<dd>方法名</dd>
<dt>func</dt>
<dd>具体的执行方法, 为None回注册失败</dd>
</dl>
</div>

								</article>
						</div>
					</div>
				</div>
			</section>
	</div>
</div>

				</div>
			</div>

		<!-- Sider Bar -->
		<div id="right-side-bar">
	<nav>
		<div id="top-toc-tree-container" class="fixed-container">
			<div class="toc-contents-title">
				<h4>Contents</h4>
				<span class="tool-tip-text">点击隐藏</span>
			</div>
			<div id="toc-tree-container">
 <ul class="toc-tree visible">
  <li class="toc-h0">
   <a class="" href="#section-1">
    加不加括号的区别
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#text">
    条件表达式下使用text
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#xpath-1">
    XPath表达式变量
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#section-2">
    移除命名空间
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#exslt">
    使用 EXSLT 拓展
   </a>
   <ul class="toc-tree visible">
    <li class="toc-h1">
     <a class="" href="#section-3">
      正则表达式支持
     </a>
    </li>
    <li class="toc-h1">
     <a class="" href="#section-4">
      集合操作
     </a>
    </li>
   </ul>
  </li>
  <li class="toc-h0">
   <a class="" href="#xpath-2">
    其他 XPath 拓展
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#python">
    添加自定义 Python 方法
   </a>
  </li>
 </ul>
</div>

		</div>
	</nav>
	<div id="sidebar-tools" class="fixed-container no-active cant-select">
		<!-- 按钮 使用 content 绘制图标 -->
	</div>
	<div id="sidebar-tool-back-top" class="fixed-container cant-select">
		<!-- 按钮 使用 content 绘制图标 -->
	</div>
		</div>

		<!-- Footer Wrapper -->
			<div id="footer-wrapper">
				<!-- Footer -->
					<section id="footer" class="container">
						<div class="row">
							<div class="8u">
								<section>
									<header>
										<h2>Latest articles</h2>
									</header>
									<ul class="dates">
										<li>
											<span class="date">Apr <strong>20</strong></span>
											<h3><a href="yq-docs-rear-end-python-python-three--party-library-transformers.html">transformers</a></h3>
											<p><p class="first last">as title</p>
</p>
										</li>
										<li>
											<span class="date">Apr <strong>02</strong></span>
											<h3><a href="yq-docs-AI-Deep-learning-tutorial-mac-gpu.html">Mac下使用GPU加速</a></h3>
											<p><p class="first last">Mac下使用GPU加速(M/A系列)</p>
</p>
										</li>
										<li>
											<span class="date">Mar <strong>30</strong></span>
											<h3><a href="yq-docs-rear-end-dart-flutter.html">Flutter</a></h3>
											<p><p class="first last">dart初识</p>
</p>
										</li>
										<li>
											<span class="date">Mar <strong>29</strong></span>
											<h3><a href="yq-docs-front-end-CSS-CSS-commonly-used-attributes-user-select.html">user-select</a></h3>
											<p><p class="first last">CSS设置元素不可被选中</p>
</p>
										</li>
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="4u">
								<section>
									<header>
										<h2>Blogroll</h2>
									</header>
									<ul class="divided">
											<li><a href="https://yq-yqr.readthedocs.io/zh/blog-theme/blog.html">旧版(迁移中)</a></li>
											<li><a href="https://getpelican.com/">Pelican</a></li>
											<li><a href="https://www.python.org/">Python.org</a></li>
											<li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
									</ul>
								</section>
							</div>
							<div class="4u">
								<section>
									<header>
										<h2>Categories</h2>
									</header>
									<ul class="divided">
											<li><a href="/category/ai.html">AI</a></li>
											<li><a href="/category/an-quan.html">安全</a></li>
											<li><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
											<li><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">
								<section>
									<header>
										<h2>SITEMAP</h2>
									</header>

									<ul class="divided">
												<li><a href="/authors.html">作者</a></li>
												<li><a href="/categories.html">分类</a></li>
												<li><a href="/archives.html">归档</a></li>
												<li><a href="/tags.html">标签</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">

								<section>
									<header>
										<h2>Contact</h2>
									</header>
									<ul class="social">
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>&copy; YanQue 2021-2024	</li>
											<!-- <li>Images: <a href="http://facebook.com/DreametryDoodle">Dreametry Doodle</a> + <a href="http://iconify.it">Iconify.it</a></li>
											<li>Design: <a href="http://html5up.net">HTML5 UP</a></li> -->
										</ul>
									</div>
							</div>
						</div>
					</section>
			</div>
		<script src="/theme/js/jquery.min.js"></script>
		<script src="/theme/js/jquery.dropotron.js"></script>
		<script src="/theme/js/config.js"></script>
		<script src="/theme/js/skel.min.js"></script>
		<script src="/theme/js/skel-panels.min.js"></script>
		<script src="/theme/js/backloading.js"></script>
<script type="text/javascript">
	function addEvent() {
		$("#top-toc-tree-container > .toc-contents-title > h4").click(function() {
			$("#top-toc-tree-container").toggleClass("no-active");
			$("#sidebar-tools").toggleClass("no-active");
		})
		$("#sidebar-tools").click(function() {
			$("#top-toc-tree-container").toggleClass("no-active");
			$("#sidebar-tools").toggleClass("no-active");
		})
		$("#sidebar-tool-back-top").click(function() {
			// window.scrollTo(0, 0);
			window.scrollTo({
				top: 0,
				left: 0,
				behavior: 'smooth'
			});
		})
	}
	addEvent()
</script>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="/theme/css/ie8.css" /><![endif]-->
	</body>
</html>