
<!DOCTYPE HTML>
<!--
	Dopetrope 2.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
			<title>书言</title>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<meta charset="utf-8" />
			<link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,300italic" rel="stylesheet" />
				<link rel="stylesheet" href="/theme/css/pygment.css" />
				<link rel="stylesheet" href="/theme/css/custom-pygment.css" />
			<noscript>
				<link rel="stylesheet" href="/theme/css/skel-noscript.css" />
				<link rel="stylesheet" href="/theme/css/style.css" />
				<link rel="stylesheet" href="/theme/css/style-desktop.css" />
			</noscript>
		<!-- tipuesearch 放在这, 因为搜索框是全局定义的 -->
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/tipuesearch.css" />
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/custom/tipuesearch-custom.css" />
		<link rel="stylesheet" href="/theme/css/alabaster.css" />
		<link rel="stylesheet" href="/theme/css/style-update.css" />
	</head>
	<body class="no-sidebar">
		<!-- Header Wrapper -->
			<div id="header-wrapper">
				<div class="container">
					<div class="row">
						<div class="12u">

							<!-- Header -->
								<section id="header">

									<!-- Logo -->
									<div class="page-home">
										<h1><a href="/">HOME</a></h1>
									</div>

									<!-- Nav -->
									<div class="page-menu">
										<nav id="nav">
											<ul>

												<!-- categories -->
														<li ><a href="/category/ai.html">AI</a></li>
														<li ><a href="/category/an-quan.html">安全</a></li>
														<li ><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
														<li  class="active"><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
														<li ><a href="/category/chang-yong-gong-ju-shi-yong.html">常用工具使用</a></li>
														<li ><a href="/category/da-shu-ju.html">大数据</a></li>
														<li><a href="/categories.html">More...</a></li>
											</ul>
										</nav>
									</div>
								</section>

						</div>
					</div>
					<div class="row page-head-search">
						<form class="navbar-search" action="/search.html" role="search">
							<!-- <button class="fa-solid fa-magnifying-glass" type="submit"></button> -->
							<button type="submit"></button>
							<input type="text" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
							<!-- <i class="fa-solid fa-magnifying-glass"></i> -->
						</form>
					</div>
  <div class="row page-head page-article persistent">
    <div class="page-head-title">
      <h2>VMware安裝OpenWrt</h2>
    </div>
    <div class="page-head-content">
      By
	  <a href="author/yanque.html">YanQue</a>
      , 09 三月 2024
      , Category:
	  <a href="category/cao-zuo-xi-tong.html">操作系统</a>
    </div>
	<div class="red-line">
    </div>
  </div>
				</div>
			</div>

		<!-- Main Wrapper -->
			<div id="main-wrapper">
				<div class="container">
<div class="row">
	<div class="12u">
			<section>
				<div>
					<div class="row">
						<div class="12u skel-cell-mainContent">
							<!-- Content -->
								<article class="box is-post">
									<div class="post-infos">
										<ul class="tags">
											<li><a class="button" href="category/cao-zuo-xi-tong.html">操作系统</a></li>
												<li><a class="button button-alt" href="tag/linux.html">Linux</a></li>

												<li><a class="button button-alt" href="tag/openwrt.html">Openwrt</a></li>

										</ul>
									</div>

									<div class="pennant pennant-alt date">2024-03-09</div>
									<h2>VMware安裝OpenWrt</h2>
									<dl class="docutils">
<dt>官网下载地址</dt>
<dd><p class="first">因为我是虚拟机安装, 系统是64位, 所以就只看这个页面的:
<a class="reference external" href="https://downloads.openwrt.org/releases/23.05.2/targets/x86/64/">https://downloads.openwrt.org/releases/23.05.2/targets/x86/64/</a>
或者通用版也行:
<a class="reference external" href="https://downloads.openwrt.org/releases/23.05.2/targets/x86/generic/">https://downloads.openwrt.org/releases/23.05.2/targets/x86/generic/</a>,</p>
<p>二选一即可</p>
<p>直接选组合包吧:</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-17-22-37.png" style="width: 480px;" />
</div>
<p>区别:</p>
<pre class="last literal-block">
ext4      rootfs可以扩展磁盘空间大小，而squashfs不能。
squashfs  rootfs可以使用重置功能（恢复出厂设置），而ext4不能。
</pre>
</dd>
</dl>
<p>虚拟机创建环境</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-17-24-52.png" style="width: 480px;" />
</div>
<p>先不安装操作系统, 选择linux</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-17-27-00.png" style="width: 480px;" />
</div>
<p>自由选择名称, 位置:</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-17-28-47.png" style="width: 480px;" />
</div>
<p>处理器给一个就行</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-17-29-30.png" style="width: 480px;" />
</div>
<p>内存默认即可(要多给也行)</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-17-29-57.png" style="width: 480px;" />
</div>
<p>网络选择桥接(这里就是使用VM的好处, 如果用docker配置地址比较麻烦)</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-17-31-07.png" style="width: 480px;" />
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<dl class="last docutils">
<dt>桥接模式</dt>
<dd>VMware桥接模式，也就是将虚拟机的虚拟网络适配器与主机的物理网络适配器进行交接，
虚拟机中的虚拟网络适配器可通过主机中的物理网络适配器直接访问到外部网络。
简而言之，这就好像局域网中添加了一台新的、独立的计算机一样。
因此，虚拟机也会占用局域网中的一个IP地址，并且可以和其他终端进行相互访问。</dd>
<dt>NAT模式</dt>
<dd>NAT，是Network Address Translation的缩写，意即网络地址转换。
NAT模式也是VMware创建虚拟机的默认网络连接模式。
使用NAT模式网络连接时，VMware会在主机上建立单独的专用网络，用以在主机和虚拟机之间相互通信。</dd>
<dt>仅主机模式</dt>
<dd>仅主机模式，是一种比NAT模式更加封闭的的网络连接模式，它将创建完全包含在主机中的专用网络。
仅主机模式的虚拟网络适配器仅对主机可见，并在虚拟机和主机系统之间提供网络连接。
相对于NAT模式而言，仅主机模式不具备NAT功能，因此在默认情况下，
使用仅主机模式网络连接的虚拟机无法连接到Internet
(在主机上安装合适的路由或代理软件，或者在Windows系统的主机上使用Internet连接共享功能，
仍然可以让虚拟机连接到Internet或其他网络)。</dd>
</dl>
</div>
<p>控制器默认即可,
磁盘选择使用 <em>/docs/杂乱无章/常用工具使用/StarWindConverter</em> 转换的虚拟机文件(需要保持现有格式):</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-18-59-10.png" style="width: 480px;" />
</div>
<p>后续看需求了, 直到 选择自定义硬件</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-17-39-35.png" style="width: 480px;" />
</div>
<p>没用的都可以去掉</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-19-00-58.png" style="width: 480px;" />
</div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p>这里补充一下, 下载的 img 的压缩包, 需要先转换为ISO文件</p>
<p>我这里使用的是WSL, 直接在cmd输入debian即可,
然后配置源, 可参考 <em>/docs/操作系统/linux/debian/配置debian容器</em></p>
<p>最后使用 <em>/docs/操作系统/linux/linux指令/genisoimage</em> 指令:</p>
<pre class="literal-block">
# 进入解压目录
cd /mnt/e/xxxxxxxxxxx/openwrt-23.05.2-x86-generic-generic-ext4-combined.img
geteltorito -o output_file.iso input_file.img
</pre>
<p>不行, 缺少库, 还是直接用我虚拟机弄吧...</p>
<pre class="literal-block">
genisoimage -o openwrt.iso openwrt-23.05.2-x86-generic-generic-ext4-combined.img
</pre>
<p class="last">实测直接转换的iso是不能用的, 还是老老实实使用工具 <em>/docs/杂乱无章/常用工具使用/StarWindConverter</em> 吧</p>
</div>
<p>然后打开虚拟机, 会安装一会儿, 出现 ready 后回车即可:</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-19-04-27.png" style="width: 480px;" />
</div>
<p>物理机 <em>/docs/操作系统/windows/windows_shell/ipconfig</em> 查看网络信息</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-19-08-02.png" style="width: 480px;" />
</div>
<p>虚拟机配置网络:</p>
<pre class="literal-block">
vi /etc/config/network
</pre>
<p>这是默认配置</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-19-10-40.png" style="width: 480px;" />
</div>
<p>按照物理机修改, 需要跟物理机同网段</p>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-19-15-35.png" style="width: 480px;" />
</div>
<p>重启虚拟机:</p>
<pre class="literal-block">
reboot
</pre>
<p>然后宿主机(物理机) 看看通不:</p>
<pre class="literal-block">
ping
</pre>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-19-17-27.png" style="width: 480px;" />
</div>
<p>登录虚拟机的系统, 地址:</p>
<pre class="literal-block">
192.168.1.80
</pre>
<div class="figure">
<img alt="" src="../../../../resources/images/2024-03-03-19-19-11.png" style="width: 480px;" />
</div>
<p>默认账密:</p>
<pre class="literal-block">
root
netflixcn.com
</pre>
<div class="section" id="section-1">
<h2>设置旁路由</h2>
<p>随后打开「网络」-&gt;「接口」配置页面，选择 LAN 接口</p>
<ul class="simple">
<li>LAN 接口的桥接选项取消勾选</li>
<li>DHCP 服务器勾选「忽略此接口」</li>
</ul>
<p>打开「网络」-&gt; 「设备」页面</p>
<ul class="simple">
<li>eth0网卡配置取消勾选「启用 IPv6」</li>
<li>br-lan接口同样取消启用「启用IPv6」</li>
</ul>
<div class="section" id="openclash">
<h3>安装 openclash</h3>
<p>两种方式可以选择</p>
<ul class="simple">
<li>直接在 openwrt 的「系统」-「软件包」中搜索下载</li>
<li>在openclash的官方仓库下载 ipk 安装包，手动上传安装</li>
</ul>
</div>
<div class="section" id="section-2">
<h3>插件设置</h3>
<p>个人习惯，倾向于使用 Fake-IP 模式。 步骤：</p>
<ul class="simple">
<li>模式使用 Fake-IP（增强）模式，打开旁路由兼容</li>
<li>本地 DNS劫持，使用 dnsmasq 转发 PS.模式也推荐使用 TUN ，
该模式下的UDP 处理性能更好，同时新增了 tun 虚拟接口，可以监管三层网络流量。</li>
</ul>
</div>
<div class="section" id="section-3">
<h3>使用</h3>
<p>至此，旁路由已经具备网络代理的功能。
家里的设备需要使用的话，需要将网络设置的ip 的网关和 DNS都指向旁路由的地址即可。
DNS的域名解析工作交给旁路由来处理，避免 DNS污染的问题。</p>
<p>参考:</p>
<ul class="simple">
<li><a class="reference external" href="https://zhuanlan.zhihu.com/p/676168607">VMware安装openWRT软路由系统的步骤(图文教程)</a></li>
<li><a class="reference external" href="https://blog.simpdog.me/posts/using-docker-to-deploy-openwrt-as-a-home-router/">通过Docker部署OpenWrt做家用旁路由</a></li>
</ul>
</div>
</div>

								</article>
						</div>
					</div>
				</div>
			</section>
	</div>
</div>

				</div>
			</div>

		<!-- Footer Wrapper -->
			<div id="footer-wrapper">
				<!-- Footer -->
					<section id="footer" class="container">
						<div class="row">
							<div class="8u">
								<section>
									<header>
										<h2>Latest articles</h2>
									</header>
									<ul class="dates">
										<li>
											<span class="date"> 3 <strong>21</strong></span>
											<h3><a href="yq-doc-source-docs-front-end-frame-jquery-jQuery-provided-methods.html">jQuery提供方法</a></h3>
											<p><p class="first last">jQuery提供常用方法/函数</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>21</strong></span>
											<h3><a href="yq-doc-do-from-sp-to-pelican.html">记录将sphinx文档库迁移到pelican</a></h3>
											<p><p class="first last">将旧的文档形式内容迁移到pelican做成博客</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>19</strong></span>
											<h3><a href="yq-doc-source-docs-version-control-git-issuses-clone-only-folder.html">仅克隆指定文件夹</a></h3>
											<p><p class="first last">当前模块或子模块仅克隆指定文件夹</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>19</strong></span>
											<h3><a href="yq-doc-source-docs-rear-end-python-python-three--party-library-googletrans.html">googletrans</a></h3>
											<p><p class="first last">python实现翻译功能</p>
</p>
										</li>
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="4u">
								<section>
									<header>
										<h2>Blogroll</h2>
									</header>
									<ul class="divided">
											<li><a href="https://yq-yqr.readthedocs.io/zh/blog-theme/blog.html">旧版(迁移中)</a></li>
											<li><a href="https://getpelican.com/">Pelican</a></li>
											<li><a href="https://www.python.org/">Python.org</a></li>
											<li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
									</ul>
								</section>
							</div>
							<div class="4u">
								<section>
									<header>
										<h2>Categories</h2>
									</header>
									<ul class="divided">
											<li><a href="/category/ai.html">AI</a></li>
											<li><a href="/category/an-quan.html">安全</a></li>
											<li><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
											<li><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">
								<section>
									<header>
										<h2>SITEMAP</h2>
									</header>

									<ul class="divided">
												<li><a href="/authors.html">作者</a></li>
												<li><a href="/categories.html">分类</a></li>
												<li><a href="/archives.html">归档</a></li>
												<li><a href="/tags.html">标签</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">

								<section>
									<header>
										<h2>Contact</h2>
									</header>
									<ul class="social">
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>&copy; YanQue 2021-2024	</li>
											<!-- <li>Images: <a href="http://facebook.com/DreametryDoodle">Dreametry Doodle</a> + <a href="http://iconify.it">Iconify.it</a></li>
											<li>Design: <a href="http://html5up.net">HTML5 UP</a></li> -->
										</ul>
									</div>
							</div>
						</div>
					</section>
			</div>
		<script src="/theme/js/jquery.min.js"></script>
		<script src="/theme/js/jquery.dropotron.js"></script>
		<script src="/theme/js/config.js"></script>
		<script src="/theme/js/skel.min.js"></script>
		<script src="/theme/js/skel-panels.min.js"></script>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="/theme/css/ie8.css" /><![endif]-->
	</body>
</html>