
<!DOCTYPE HTML>
<!--
	Dopetrope 2.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
			<title>书言</title>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<meta charset="utf-8" />
			<link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,300italic" rel="stylesheet" />
				<link rel="stylesheet" href="/theme/css/pygment.css" />
			<noscript>
				<link rel="stylesheet" href="/theme/css/skel-noscript.css" />
				<link rel="stylesheet" href="/theme/css/style.css" />
				<link rel="stylesheet" href="/theme/css/style-desktop.css" />
			</noscript>
		<link rel="stylesheet" href="/theme/css/alabaster.css" />
		<link rel="stylesheet" href="/theme/css/style-update.css" />
	</head>
	<body class="no-sidebar">
		<!-- Header Wrapper -->
			<div id="header-wrapper">
				<div class="container">
					<div class="row">
						<div class="12u">

							<!-- Header -->
								<section id="header">

									<!-- Logo -->
									<div class="page-home">
										<h1><a href="/">HOME</a></h1>
									</div>

									<!-- Nav -->
									<div class="page-menu">
										<nav id="nav">
											<ul>

												<!-- categories -->
														<li ><a href="/category/ai.html">AI</a></li>
														<li ><a href="/category/an-quan.html">安全</a></li>
														<li ><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
														<li  class="active"><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
														<li ><a href="/category/chang-yong-gong-ju-shi-yong.html">常用工具使用</a></li>
														<li ><a href="/category/da-shu-ju.html">大数据</a></li>
														<li><a href="/categories.html">More...</a></li>
											</ul>
										</nav>
									</div>
								</section>

						</div>
					</div>
  <div class="row page-head page-article persistent">
    <div class="page-head-title">
      <h2>linux系统环境加载顺序</h2>
    </div>
    <div class="page-head-content">
      By
	  <a href="author/yanque.html">YanQue</a>
      , 26 二月 2023
      , Category:
	  <a href="category/cao-zuo-xi-tong.html">操作系统</a>
    </div>
	<div class="red-line">
    </div>
  </div>
				</div>
			</div>

		<!-- Main Wrapper -->
			<div id="main-wrapper">
				<div class="container">
<div class="row">
	<div class="12u">
			<section>
				<div>
					<div class="row">
						<div class="12u skel-cell-mainContent">
							<!-- Content -->
								<article class="box is-post">
									<div class="post-infos">
										<ul class="tags">
											<li><a class="button" href="category/cao-zuo-xi-tong.html">操作系统</a></li>
												<li><a class="button button-alt" href="tag/linux.html">Linux</a></li>

												<li><a class="button button-alt" href="tag/gai-nian-xing.html">概念性</a></li>

										</ul>
									</div>

									<div class="pennant pennant-alt date">2023-02-26</div>
									<h2>linux系统环境加载顺序</h2>
									<div class="section" id="shell-login-shell">
<h2>登陆shell(login shell)</h2>
<p>取得 bash 时需要完整的登陆流程的，就称为 login shell.
比如通过ssh方式连接，或者由tty1 ~ tty6 登陆，
需要输入用户的账号与密码，此时取得的 bash 就称为login shell</p>
<p>当我们在终端上运行 <cite>bash</cite>、<cite>zsh</cite> 等命令登录系统时,启动的shell就是登录shell。
它的环境变量加载顺序是:</p>
<ul class="simple">
<li>/etc/profile 此文件为系统的每个用户设置环境信息，当用户第一次登录时，该文件被执行。 并从/etc/profile.d目录的配置文件中搜集shell的设置。</li>
<li>/etc/bashrc 为每一个运行bash shell的用户执行此文件。当bash shell被打开时，该文件被读取。</li>
<li>~/.bash_profile 每个用户都可使用该文件输入专用于自己使用的shell信息，当用户登录时，该文件仅仅执行一次！默认情况下，他设置一些环境变量，执行用户的。bashrc文件。</li>
<li>~/.bash_login</li>
<li>~/.profile</li>
<li>~/.bashrc 该文件包含专用于你的bash shell的bash信息，当登录时以及每次打开新的shell时，该该文件被读取。</li>
<li>~/.bash_logout 当每次退出系统（退出bash shell）时，执行该文件。
另外，/etc/profile中设定的变量（全局）的可以作用于任何用户，而~/.bashrc等中设定的变量（局部）只 能继承/etc/profile中的变量，他们是&quot;父子&quot;关系。</li>
<li>~/.bash_profile 是交互式、login 方式进入 bash 运行的
~/.bashrc 是交互式 non-login 方式进入 bash 运行的通常二者设置大致相同，所以通常前者会调用后者。</li>
</ul>
</div>
<div class="section" id="shell-non-login-shell">
<h2>非登陆shell(non-login shell)</h2>
<p>取得 bash 接口的方法不需要重复登陆的举动.
比如你以 X window 登陆 Linux 后， 再以 X 的图形化接口启动终端机，
此时该终端接口无需输入账号与密码，则为non-login shell;
又比如你在原本的 bash 环境下再次下达 bash 这个命令，
同样的也没有输入账号密码， 那第二个 bash (子程序) 也是 non-login shell.</p>
<p>当我们在终端上运行 <cite>bash -c 'command'</cite> 或在GUI程序中启动shell时,启动的shell就是非登录shell。
它的环境变量加载顺序是:</p>
<ul class="simple">
<li>/etc/bash.bashrc</li>
<li>~/.bashrc</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">可以通过 echo $0 查看属于那种Shell</p>
</div>
</div>
<div class="section" id="section-1">
<h2>演示</h2>
<p>演示环境:</p>
<pre class="literal-block">
[root&#64;system1 ~]# more /etc/redhat-release
Red Hat Enterprise Linux Server release 7.0 (Maipo)
</pre>
<p>当前从ssh登陆到服务器:</p>
<pre class="literal-block">
[root&#64;system1 ~]# tty
/dev/pts/1
</pre>
<p>输入 echo $0， 显示结果为 -bash ，即为登陆shell:</p>
<pre class="literal-block">
[root&#64;system1 ~]# echo $0
-bash
[root&#64;system1 ~]# ps
  PID TTY          TIME CMD
77122 pts/1    00:00:00 bash
77157 pts/1    00:00:00 ps
</pre>
<p>下面在X windows打开一个终端，如下，显示为/bin/bash，即非登陆shell:</p>
<pre class="literal-block">
[root&#64;system1 Desktop]# echo $0
/bin/bash

[root&#64;system1 ~]# ps -ef|grep pts|grep bash
root      73245  73241  0 11:49 pts/0    00:00:00 /bin/bash
root      76511  73245  0 16:19 pts/0    00:00:00 bash
root      77122  77118  0 17:02 pts/1    00:00:00 -bash
root      77158  77118  0 17:03 pts/2    00:00:00 -bash
root      77210  73241  0 17:04 pts/3    00:00:00 /bin/bash
root      77283  77279  0 17:06 pts/4    00:00:00 -bash
root      77332  77122  0 17:06 pts/1    00:00:00 grep --color=auto bash
</pre>
<p>在上传的结果中73245，77210为非登陆shell，77122，77158，77283为登陆shell</p>
</div>
<div class="section" id="shell-interactive-shell">
<h2>交互式shell(interactive shell)</h2>
<p>交互式模式就是在终端上执行，shell等待你的输入，并且立即执行你提交的命令。
这种模式被称作交互式是因为shell与用户进行交互。
这种模式也是大多数用户非常熟悉的：登录、执行一些命令、退出。当你退出后，shell也终止了。</p>
<p>无论是登录shell还是非登录shell,只要它 attach 到当前终端并接受用户的输入,
那它就是一个交互式shell。
交互式shell的环境变量加载顺序包括:</p>
<ul class="simple">
<li>登录shell或非登录shell加载的所有文件</li>
<li>~/.inputrc</li>
</ul>
</div>
<div class="section" id="shell-non-interactive-shell">
<h2>非交互式shell(non-interactive shell)</h2>
<p>shell也可以运行在另外一种模式：非交互式模式，以shell script(非交互)方式执行。
在这种模式 下，shell不与你进行交互，而是读取存放在文件中的命令,并且执行它们。
当它读到文件的结尾EOF，shell也就终止了。</p>
<p>如果一个shell在后台执行,不接受任何用户输入,那么它就是非交互式shell。非交互式shell仅加载:</p>
<ul class="simple">
<li>登录shell加载的文件(/etc/profile和~/.bash_profile)</li>
<li>非登录shell加载的文件(/etc/bash.bashrc)</li>
</ul>
<p>如下，执行 echo $-，查看其中的“i”选项（表示interactive shell）:</p>
<pre class="literal-block">
[root&#64;system1 ~]# echo $-
himBH
</pre>
<p>如下，为非交互shell:</p>
<pre class="literal-block">
[root&#64;system1 ~]# echo 'echo $-' | bash
hB
</pre>
</div>
<div class="section" id="section-2">
<h2>环境变量的调用顺序</h2>
<p>对于登陆shell，读取~/.bash_profile配置文件时，会做出读取顺序判读，如下:</p>
<pre class="literal-block">
~/.bash_profile —&gt; ~/.bash_login  —&gt; ~/.profile
</pre>
<p>但 bash 的 login shell 配置只会读取上面三个文件的其中一个， 而读取的顺序则是依照上面的顺序。
也就是说，如果 ~/.bash_profile 存在，那么其他两个文件不论有无存在，都不会被读取。
如果 ~/.bash_profile 不存在才会去读取 ~/.bash_login，而前两者都不存在才会读取 ~/.profile 的意思。</p>
<p>在shell登出时会读取 ~/.bash_logout</p>
<p><strong>属于非登录shell：不需要输入密码的登录及远程 SSH 连接——&gt;  ~/.bashrc（用户文件U2）——&gt;/etc/bashrc（全局文件G2）</strong></p>
<p>如果用户的Shell 不是登录时启动的（比如手动敲下 bash 时启动或者其他不需要输入密码的登录及远程 SSH 连接情况）
那么这种非登录 Shell 只会加载 <cite>~/.bashrc`（用户环境变量文件），并会去找 `/etc/bashrc`（全局环境变量文件），
因此如果希望在非登录 Shell 下也可读到设置的环境变量等内容，
就需要将变量设定写入 `~/.bashrc</cite> 或者 <cite>/etc/bashrc</cite>，而不是 <cite>~/.bash_profile</cite> 或 <cite>/etc/profile</cite></p>
</div>
<div class="section" id="section-3">
<h2>环境变量相关文件</h2>
<ul class="simple">
<li>/etc/profile：系统配置文件，用户登录时读取一次</li>
<li>/etc/profile.d: 系统配置文件夹, 一般下面的 <cite>.sh</cite> 文件会在/etc/profile加载之后进行加载</li>
<li>/etc/bash.bashrc：（Ubuntu）系统配置文件，用户登录时读取一次，每次打开一个新终端会话时读取一次。</li>
<li>/etc/bashrc： （Centos）系统配置文件，用户登录时读取一次，每次打开一个新终端会话时读取一次。</li>
<li>~/.profile（~/.bash_profile、~/.bash_login）：用户配置文件，用户登录时读取一次</li>
<li>~/.bashrc：用户配置文件，用户登录时读取一次，每次打开一个新终端会话时读取一次</li>
</ul>
<p>对于 ~/.bash_profile、~/.bash_login、~/.profile，如果终端绑定的是 bash，
则按照顺序进行读取（如果存在，就不继续读取）</p>
<ul class="simple">
<li>系统配置文件作用于全局，而用户配置文件仅针对当前登录的用户</li>
<li>先读取系统配置文件，再读取用户配置文件，用户配置文件的变量和表达式等都继承自系统配置文件</li>
</ul>
</div>

								</article>
						</div>
					</div>
				</div>
			</section>
	</div>
</div>

				</div>
			</div>

		<!-- Footer Wrapper -->
			<div id="footer-wrapper">
				<!-- Footer -->
					<section id="footer" class="container">
						<div class="row">
							<div class="8u">
								<section>
									<header>
										<h2>Latest articles</h2>
									</header>
									<ul class="dates">
										<li>
											<span class="date"> 3 <strong>19</strong></span>
											<h3><a href="yq-doc-source-docs-version-control-git-issuses-clone-only-folder.html">仅克隆指定文件夹</a></h3>
											<p><p class="first last">当前模块或子模块仅克隆指定文件夹</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>19</strong></span>
											<h3><a href="yq-doc-source-docs-rear-end-python-python-three--party-library-googletrans.html">googletrans</a></h3>
											<p><p class="first last">python实现翻译功能</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>18</strong></span>
											<h3><a href="yq-os-linux-ubuntu-issues.html">gnome刷新desktop缓存</a></h3>
											<p><p class="first last">gnome图标文件缓存刷新</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>17</strong></span>
											<h3><a href="yq-doc-vs-plugin.html">Vscode文档相关插件.rst</a></h3>
											<p><p class="first last">Vscode文档相关实用插件</p>
</p>
										</li>
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="4u">
								<section>
									<header>
										<h2>Blogroll</h2>
									</header>
									<ul class="divided">
											<li><a href="https://yq-yqr.readthedocs.io/zh/blog-theme/blog.html">旧版(迁移中)</a></li>
											<li><a href="https://getpelican.com/">Pelican</a></li>
											<li><a href="https://www.python.org/">Python.org</a></li>
											<li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
									</ul>
								</section>
							</div>
							<div class="4u">
								<section>
									<header>
										<h2>Categories</h2>
									</header>
									<ul class="divided">
											<li><a href="/category/ai.html">AI</a></li>
											<li><a href="/category/an-quan.html">安全</a></li>
											<li><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
											<li><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">
								<section>
									<header>
										<h2>SITEMAP</h2>
									</header>

									<ul class="divided">
												<li><a href="/authors.html">作者</a></li>
												<li><a href="/categories.html">分类</a></li>
												<li><a href="/archives.html">归档</a></li>
												<li><a href="/tags.html">标签</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">

								<section>
									<header>
										<h2>Contact</h2>
									</header>
									<ul class="social">
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>&copy; YanQue 2021-2024	</li>
											<!-- <li>Images: <a href="http://facebook.com/DreametryDoodle">Dreametry Doodle</a> + <a href="http://iconify.it">Iconify.it</a></li>
											<li>Design: <a href="http://html5up.net">HTML5 UP</a></li> -->
										</ul>
									</div>
							</div>
						</div>
					</section>
			</div>
		<script src="/theme/js/jquery.min.js"></script>
		<script src="/theme/js/jquery.dropotron.js"></script>
		<script src="/theme/js/config.js"></script>
		<script src="/theme/js/skel.min.js"></script>
		<script src="/theme/js/skel-panels.min.js"></script>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="/theme/css/ie8.css" /><![endif]-->
	</body>
</html>