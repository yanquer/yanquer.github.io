
<!DOCTYPE HTML>
<!--
	Dopetrope 2.0 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html data-theme="dark">
	<head>
			<title>书言</title>
			<meta http-equiv="content-type" content="text/html; charset=utf-8" />
			<meta charset="utf-8" />

			<!-- <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,300italic" rel="stylesheet" /> -->
			<link rel="stylesheet" href="/theme/css/custom-pygment.css" />
			<noscript>
				<link rel="stylesheet" href="/theme/css/skel-noscript.css" />
				<link rel="stylesheet" href="/theme/css/style.css" />
				<link rel="stylesheet" href="/theme/css/style-desktop.css" />
			</noscript>

		<!-- tipuesearch 放在这, 因为搜索框是全局定义的 -->
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/tipuesearch.css" />
		<link rel="stylesheet" href="/theme//Tipue-Search-5.0.0/custom/tipuesearch-custom.css" />
		<link rel="stylesheet" href="/theme/css/alabaster.css" />
		<link rel="stylesheet" href="/theme/css/custom-alabaster.css" />
		<!-- <link rel="stylesheet" href="/theme/fontawesome-free-6.5.1-web/css/all.min.css" /> -->
		<!--  <link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-brands-400.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-regular-400.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-solid-900.woff2" />
		<link rel="preload" as="font" type="font/woff2" crossorigin href="/theme/fontawesome-free-6.5.1-web/webfonts/fa-v4compatibility.woff2" /> -->


	</head>
	<body class="no-sidebar">

		<!-- 内容 -->
		<div>

			<!-- Header Wrapper -->
			<div id="header-wrapper">
				<div class="container">
					<div class="row">
						<div class="12u">

							<!-- Header -->
								<section id="header">

									<!-- Logo -->
									<div class="page-home">
										<h1><a href="/">HOME</a></h1>
									</div>

									<!-- Nav -->
									<div class="page-menu">
										<nav id="nav">
											<ul>

												<!-- categories -->
														<li ><a href="/category/ai.html">AI</a></li>
														<li ><a href="/category/an-quan.html">安全</a></li>
														<li ><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
														<li  class="active"><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
														<li ><a href="/category/chang-yong-gong-ju-shi-yong.html">常用工具使用</a></li>
														<li ><a href="/category/da-shu-ju.html">大数据</a></li>
														<li><a href="/categories.html">More...</a></li>
											</ul>
										</nav>
									</div>
								</section>

						</div>
					</div>
					<div class="row page-head-search">
						<form class="navbar-search" action="/search.html" role="search">
							<!-- <button class="fa-solid fa-magnifying-glass" type="submit"></button> -->
							<button type="submit"></button>
							<input type="text" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
							<!-- <i class="fa-solid fa-magnifying-glass"></i> -->
						</form>
					</div>
  <div class="row page-head page-article persistent">
    <div class="page-head-title">
      <h2>常用头文件</h2>
    </div>
    <div class="page-head-content">
      By
	  <a href="author/yanque.html">YanQue</a>
      , 20 二月 2023
      , Category:
	  <a href="category/cao-zuo-xi-tong.html">操作系统</a>
    </div>
	<div class="red-line">
    </div>
  </div>
				</div>

				<!-- 头部下方动效 -->
				<div class="waves-area">
					<section class="main-hero-waves-area waves-area">
						<svg class="waves-svg" preserveAspectRatio="none" shape-rendering="auto" viewBox="0 24 150 28"
							 xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
							<defs>
								<path
										d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"
										id="gentle-wave"></path>
							</defs>
							<g class="parallax">
								<use href="#gentle-wave" x="48" y="0"></use>
								<use href="#gentle-wave" x="48" y="3"></use>
								<use href="#gentle-wave" x="48" y="5"></use>
								<use href="#gentle-wave" x="48" y="7"></use>
							</g>
						</svg>
					</section>
				</div>

			</div>

		<!-- Main Wrapper -->
			<div id="main-wrapper">
				<div class="container">
<div class="row">
	<div class="12u">
			<section>
				<div>
					<div class="row">
						<div class="12u skel-cell-mainContent">
							<!-- Content -->
								<article class="box is-post">
									<div class="box-head">
										<div class="post-infos">
											<ul class="tags">
												<li><a class="button" href="category/cao-zuo-xi-tong.html">操作系统</a></li>
													<li><a class="button button-alt" href="tag/windows.html">Windows</a></li>

													<li><a class="button button-alt" href="tag/windowszhi-xing-wen-jian-da-bao.html">Windows执行文件打包</a></li>

													<li><a class="button button-alt" href="tag/nsis.html">Nsis</a></li>

											</ul>
										</div>

										<div class="pennant pennant-alt date">2023-02-20</div>
										<h2>常用头文件</h2>

										<span class="head-modify-time">修改于: 2024-09-20</span>

									</div>
									<div class="section" id="mui-nsh">
<h2>MUI.nsh</h2>
<p>Modern User Interface 是NSIS脚本中一个非常常用的头文件，它提供了一系列现代化的用户界面元素，
包括简单易用的安装向导、控件和页面。使用&quot;MUI.nsh&quot;可以轻松地创建具有现代风格的安装程序，而无需编写复杂的代码。</p>
<p>常用的指令:</p>
<pre class="literal-block">
!insertmacro MUI_PAGE_WELCOME：添加欢迎页面。
!insertmacro MUI_PAGE_LICENSE：添加许可证协议页面。
!insertmacro MUI_PAGE_DIRECTORY：添加选择安装位置页面。
!insertmacro MUI_PAGE_INSTFILES：添加文件安装进度页面。
!insertmacro MUI_PAGE_FINISH：添加安装完成页面。
!insertmacro MUI_LANGUAGE：设置安装程序的语言。
</pre>
<p>如设置安装语言为英文:</p>
<pre class="literal-block">
!insertmacro MUI_LANGUAGE &quot;English&quot;
</pre>
<p>设置为中文:</p>
<pre class="literal-block">
!insertmacro MUI_LANGUAGE &quot;SimpChinese&quot;
</pre>
</div>
<div class="section" id="winmessages-nsh">
<h2>WinMessages.nsh</h2>
<p>WinMessages.nsh 是一个 NSIS 头文件，它提供了一组用于发送窗口消息的指令。这些指令可以用来与窗口进行交互，例如设置窗口标题、更改窗口样式等。</p>
<div class="section" id="section-2">
<h3>设置环境变量</h3>
<div class="highlight"><pre><span></span><span class="cp">!include</span><span class="w"> </span>WinMessages.nsh

<span class="c">; 获取到系统原有的环境变量</span>
<span class="k">ReadRegStr</span><span class="w"> </span><span class="bp">$0</span><span class="w"> </span><span class="no">HKLM</span><span class="w"> </span><span class="s2">&quot;SYSTEM\CurrentControlSet\Control\Session Manager\Environment&quot;</span><span class="w"> </span><span class="s2">&quot;Path&quot;</span>
<span class="c">; 在原有的环境变量里追加 D:\test 目录</span>
<span class="k">WriteRegExpandStr</span><span class="w"> </span><span class="no">HKLM</span><span class="w"> </span><span class="s2">&quot;SYSTEM\CurrentControlSet\Control\Session Manager\Environment&quot;</span><span class="w"> </span><span class="s2">&quot;Path&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="bp">$0</span><span class="s2">;D:\test&quot;</span>

<span class="c">; nsis打包程序写入环境变量不能立即生效，需要调用SendMessage的api才能避免重启</span>
<span class="c">; SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 &quot;STR:Environment&quot;</span>
<span class="c">; 不使用超时可能会因为其他窗口不响应导致卡死. 所以加个 /TIMEOUT 避免</span>
<span class="k">SendMessage</span><span class="w"> </span><span class="kp">${HWND_BROADCAST}</span><span class="w"> </span><span class="kp">${WM_WININICHANGE}</span><span class="w"> </span>0<span class="w"> </span><span class="s2">&quot;STR:Environment&quot;</span><span class="w"> </span><span class="na">/TIMEOUT</span><span class="err">=</span>500
</pre></div>
<dl class="docutils">
<dt>关于SendMessage卡死可参考</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://blog.csdn.net/weixin_41212181/article/details/126289189">NSIS刷新系统环境变量</a></li>
<li><a class="reference external" href="https://stackoverflow.com/questions/1951658/sendmessagehwnd-broadcast-hangs">SendMessage(HWND_BROADCAST, ....) hangs</a></li>
</ul>
</dd>
</dl>
<p>第二链接的部分摘录</p>
<blockquote>
<p>This will happen when there is an process that has a top level window, but isn't calling GetMessage or PeekMessage on the thread that created the window.</p>
<p>For backward compatibility with Windows 3.0, SendMessage will not return until all of the top level windows in the system have responded to your broadcast. This behavior made sense back before Windows was multithreaded, because SendMessage, even when sending to other processes would never block.</p>
<p>But beginning with Win32, when you SendMessage to a window in another process, what actually happens is your thread blocks until the thread in the other process wakes up and handles the message. If that thread is busy, or just not pumping messages, then you wait forever.</p>
<p>For that reason you should always use SendNotifyMessage or SendMessageTimeout when you use HWND_BROADCAST, or are otherwise sending messages to windows owned by other processes.</p>
<p>(机翻)
当某个进程具有顶层窗口，但是未在创建该窗口的线程上调用 GetMessage 或 PeekMessage 时，就会发生这种情况。
为了向后兼容 Windows 3.0，SendMessage 直到系统中的所有顶级窗口都响应您的广播后才会返回。这种行为在 Windows 成为多线程之前是有意义的，因为 SendMessage 即使在发送到其他进程时也永远不会阻塞。
但是从 Win32 开始，当您向另一个进程中的窗口发送消息时，实际发生的情况是您的线程被阻塞，直到另一个进程中的线程被唤醒并处理该消息。如果该线程很忙，或者只是没有发送消息，那么您将永远等待。
因此，当您使用 HWND_BROADCAST 时，或者以其他方式向其他进程拥有的窗口发送消息时，您应该始终使用 SendNotifyMessage 或 SendMessageTimeout。</p>
</blockquote>
</div>
</div>

								</article>
						</div>
					</div>
				</div>
			</section>
	</div>
</div>

				</div>
			</div>



		<!-- Sider Bar -->
		<div id="right-side-bar">
	<nav>
		<div id="top-toc-tree-container" class="fixed-container">
			<div class="toc-contents-title">
				<h4 id="toc-contents-title-text">Contents</h4>
				<!-- <span class="tool-tip-text">点击隐藏</span> -->
			</div>
			<div id="toc-tree-container">
 <ul class="toc-tree visible">
  <li class="toc-h0">
   <a class="" href="#mui-nsh">
    MUI.nsh
   </a>
  </li>
  <li class="toc-h0">
   <a class="" href="#winmessages-nsh">
    WinMessages.nsh
   </a>
   <ul class="toc-tree visible">
    <li class="toc-h1">
     <a class="" href="#section-2">
      设置环境变量
     </a>
    </li>
   </ul>
  </li>
 </ul>
</div>

		</div>
	</nav>
	<div id="sidebar-tools" class="fixed-container no-active cant-select">
		<!-- 按钮 使用 content 绘制图标 -->
	</div>
	<div id="sidebar-tool-back-top" class="fixed-container cant-select">
		<!-- 按钮 使用 content 绘制图标 -->
	</div>
		</div>

		<!-- Footer Wrapper -->
			<div id="footer-wrapper">
				<!-- Footer -->
					<section id="footer" class="container">
						<div class="row">
							<div class="8u">
								<section>
									<header>
										<h2>Latest articles</h2>
									</header>
									<ul class="dates">
										<li>
											<span class="date">10 <strong>28</strong></span>
											<h3><a href="yq-docs-operating-system-Windows-tutorial-app-is-admin.html">判断应用是否以管理员权限运行</a></h3>
											<p><p class="first last">判断应用是否以管理员权限运行</p>
</p>
										</li>
										<li>
											<span class="date">10 <strong>28</strong></span>
											<h3><a href="yq-docs-rear-end-python-python-standard-library-base64.html">base64</a></h3>
											<p><p class="first last">base64</p>
</p>
										</li>
										<li>
											<span class="date"> 3 <strong>09</strong></span>
											<h3><a href="yq-docs-Safety-Reverse-Engineering-compilation.html">汇编</a></h3>
											<p><p class="first last">汇编</p>
</p>
										</li>
										<li>
											<span class="date">10 <strong>21</strong></span>
											<h3><a href="yq-docs-front-end-CSS-CSS-commonly-used-attributes-pointer-events.html">pointer-events</a></h3>
											<p><p class="first last">as title</p>
</p>
										</li>
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="4u">
								<section>
									<header>
										<h2>Blogroll</h2>
									</header>
									<ul class="divided">
											<li><a href="https://yq-yqr.readthedocs.io/zh/blog-theme/blog.html">旧版(迁移中)</a></li>
											<li><a href="https://getpelican.com/">Pelican</a></li>
											<li><a href="https://www.python.org/">Python.org</a></li>
											<li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
									</ul>
								</section>
							</div>
							<div class="4u">
								<section>
									<header>
										<h2>Categories</h2>
									</header>
									<ul class="divided">
											<li><a href="/category/ai.html">AI</a></li>
											<li><a href="/category/an-quan.html">安全</a></li>
											<li><a href="/category/ban-ben-kong-zhi.html">版本控制</a></li>
											<li><a href="/category/cao-zuo-xi-tong.html">操作系统</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">
								<section>
									<header>
										<h2>SITEMAP</h2>
									</header>

									<ul class="divided">
												<li><a href="/authors.html">作者</a></li>
												<li><a href="/categories.html">分类</a></li>
												<li><a href="/archives.html">归档</a></li>
												<li><a href="/tags.html">标签</a></li>
									</ul>
								</section>
							</div>

							<div class="4u">

								<section>
									<header>
										<h2>Contact</h2>
									</header>
									<ul class="social">
									</ul>
								</section>
							</div>
						</div>
						<div class="row">
							<div class="12u">
								<!-- Copyright -->
									<div id="copyright">
										<ul class="links">
											<li>&copy; YanQue 2019-2024	</li>
											<!-- <li>Images: <a href="http://facebook.com/DreametryDoodle">Dreametry Doodle</a> + <a href="http://iconify.it">Iconify.it</a></li>
											<li>Design: <a href="http://html5up.net">HTML5 UP</a></li> -->
										</ul>
									</div>
							</div>
						</div>
					</section>
			</div>

		</div>

		<!-- 其他 -->

			<div style="position: fixed;">
				<!-- 深色模式粒子效果 -->
				<!-- <canvas id="universe" width="1428" height="993" data-relingo-block="true" data-relingo-parsed="true"></canvas> -->
				<!-- 深色模式下添加粒子效果canvas -->
				<canvas id="universe" width="1312" height="880"></canvas>
			</div>

		<script src="/theme/js/jquery-3.7.1.min.js"></script>
		<script src="/theme/js/jquery.dropotron.js"></script>
		<script src="/theme/js/config.js"></script>
		<script src="/theme/skel-s0.4.8/skel.min.js"></script>
		<script src="/theme/skel-s0.4.8/skel-panels.min.js"></script>
		<!-- <script src="/theme/js/skel.min.js"></script>
		<script src="/theme/js/skel-panels.min.js"></script> -->
		<script src="/theme/js/backloading.js"></script>
		<script src="/theme/js/canvas/dark.js"></script>
<script type="text/javascript">
	function addEvent() {
		$("#toc-contents-title-text").click(function() {
			$("#top-toc-tree-container").toggleClass("no-active");
			$("#sidebar-tools").toggleClass("no-active");
		})
		$("#sidebar-tools").click(function() {
			$("#top-toc-tree-container").toggleClass("no-active");
			$("#sidebar-tools").toggleClass("no-active");
		})
		$("#sidebar-tool-back-top").click(function() {
			// window.scrollTo(0, 0);
			window.scrollTo({
				top: 0,
				left: 0,
				behavior: 'smooth'
			});
		})
	}
	addEvent()
</script>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><link rel="stylesheet" href="/theme/css/ie8.css" /><![endif]-->
	</body>
</html>